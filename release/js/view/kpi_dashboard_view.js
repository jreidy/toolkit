(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","util/util","model/user","model/loading","model/kpi_categories","view/navbar_view","view/loading_view","text!template/kpi_categories.html","view/tab_controller","view/data_visualization"],function(e,n,r,i,s,o,u,a,f,l,c){var h;return h=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.el="#main",r.prototype.template=e.template(f),r.prototype.initialize=function(){var t,n;return this.currentPie=0,this.number=4,this.selected="t0",e.bindAll(this),this.bindEvents(),this._preRender(),this.model=new o,this.user=new i,this.user.on("change:userName",this.userDataReady),this.currentCategoryIndex=0,this.currentKPIIndex=0,t=document.getElementById("body"),t.className="2",n=new u({model:this.user}),this.model.on("reset",this.kpiCategoriesReady)},r.prototype.bindEvents=function(){var e,t,n,r,i,s;this.$el.undelegate("#previousKPI"),this.$el.undelegate("#nextKPI");for(n=i=0;i<4;n=++i)this.$el.undelegate("tab_default"+n);e="createTouch"in document?"tap":"click",t={},t[""+e+" #previousKPI"]="previousKPI",t[""+e+" #nextKPI"]="nextKPI";for(n=s=0;s<4;n=++s)r="#t"+n,t[""+e+" "+r]="tabSelected";return this.delegateEvents(t)},r.prototype._preRender=function(){return this.loadingView=new a},r.prototype.userDataReady=function(){return this.model.access_token=this.user.getAccessToken(),this.fetchKpiCategories()},r.prototype.fetchKpiCategories=function(){return this.model.fetch({dataType:"jsonp"})},r.prototype.kpiCategoriesReady=function(){return this.loadingView.empty(),this.render()},r.prototype.render=function(){var e;return this.items=this.model.toJSON(),this.$el.html(this.template),this.currentCategoryIndex=0,this.currentKPIIndex=0,this.updateContent(),this.createTabs(),this.updatePie(),e=new c},r.prototype.updateIndex=function(e,t,n){var r;return r=t-1,n+=e,n>r?n=0:n<0&&(n=r),n},r.prototype.nextKPI=function(){return this.currentKPIIndex=this.updateIndex(1,this.items[this.currentCategoryIndex].data.length,this.currentKPIIndex),this.updateContent(),this.updatePie()},r.prototype.previousKPI=function(){return this.currentKPIIndex=this.updateIndex(-1,this.items[this.currentCategoryIndex].data.length,this.currentKPIIndex),this.updateContent(),this.updatePie()},r.prototype.updateContent=function(){return this.$(".KPI_head").text(this.items[this.currentCategoryIndex].name),this.$(".numberLabel").text(this.items[this.currentCategoryIndex].data.length),this.$(".kpiName").text(this.items[this.currentCategoryIndex].data[this.currentKPIIndex].name)},r.prototype.updatePie=function(){return this.currentPie=this.currentPie+1,this.currentPie>3&&(this.currentPie=1),document.getElementById("pie").className="pie_"+this.currentPie},r.prototype.createTabs=function(){var e;return e=new l({model:this.number})},r.prototype.tabSelected=function(){var e,t;if(event.target.id!==this.selected&&event.target.className!=="x_icon"&&event.target.className!=="tab_default_x")return event.target.className="tab_bar_selected",e=101,document.getElementById(event.target.id).style.zIndex=e.toString(),t=100-this.selected[1]-1,document.getElementById(this.selected).style.zIndex=t.toString(),this.selected==="t0"?document.getElementById(this.selected).className="tab_bar_first":document.getElementById(this.selected).className="tab_default",this.selected=event.target.id,this.currentKPIIndex=0,this.currentCategoryIndex=this.selected[1],this.updateContent()},r}(n.View),h})}).call(this)