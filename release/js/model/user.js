(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","zepto","util/util","model/gauth"],function(e,n,r,i,s){var o;return o=function(i){function f(){return f.__super__.constructor.apply(this,arguments)}var o,u,a;return t(f,i),u=null,a=null,o=null,f.prototype.url=function(){return"https://www.googleapis.com/oauth2/v2/userinfo?access_token="+o},f.prototype.initialize=function(){return e.bindAll(this),this.id="local_user",this.localStorage=new n.LocalStorage(this.id),this.on("destroy",this.userDestroyed),u=new s,u.on("change:access_token",this.authAccessTokenChanged)},f.prototype.userDestroyed=function(){return u.destroy()},f.prototype.authAccessTokenChanged=function(){var e,t=this;o=u.get("access_token"),this.fetch();if(!(((e=this.get("userName"))!=null?e.length:void 0)>0))return this.load().always(function(e){var n,r;return e!=null&&((r=e["email"])!=null?r.length:void 0)?(n=/(.*)@/.exec(e.email),n&&(e.userName=n[1]),e.uid=e.id,e.id=t.id,t.set(e),t.save()):t.trigger("fetch:error")})},f.prototype.load=function(){return r.ajax({dataType:"jsonp",url:this.url()})},f.prototype.authorized=function(){return u.fetch(),u.authorized()},f.prototype.getAuthUrl=function(){return u.getAuthUrl()},f.prototype.getAccessToken=function(){return u.get("access_token")},f.prototype.isGreeAccount=function(){return this.get("email").indexOf("@gree.co.jp")>0},f}(n.Model),o})}).call(this)