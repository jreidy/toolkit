(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["underscore","backbone","util/util"],function(e,n,r){var i;return i=function(i){function o(){return o.__super__.constructor.apply(this,arguments)}var s;return t(o,i),o.prototype.client_id="JRCYYUZK5Q2GENAPUH2CNW2SG1RNVVBDDTADCOB1BWPQVUFK",o.prototype.client_secret="JKQOKQ2SVHVMO5VOOZQAFG55ZG2Y14EUPL44510SEZZUYMJH",o.prototype.v="20120426",o.prototype.urlRoot="https://api.foursquare.com/v2/venues/search",o.prototype.countryCityMap={China:"Beijing",Japan:"Tokyo","United States":"CB, SF",Argentina:"Buenos Aires"},o.prototype.countryAbbrs={Argentina:"ARG",China:"CN",Japan:"JP","United States":"US"},s={latitude:37.7882888570246,longitude:-122.39682522210278},o.prototype.url=function(){return""+this.urlRoot+"?ll="+this.get("latitude")+","+this.get("longitude")+"&client_id="+this.client_id+"&client_secret="+this.client_secret+"&v="+this.v},o.prototype.initialize=function(){return e.bindAll(this),this.id="foursquare_location",this.localStorage=new n.LocalStorage(this.id)},o.prototype.locate=function(){return this.trigger("locating"),navigator.geolocation.getCurrentPosition(this.getLocationSuccess,this.getLocationFail,{maximumAge:6e4})},o.prototype.getLocationSuccess=function(e){var t,n,r,i,s;r=e.coords.latitude,i=e.coords.longitude,this.fetch(),t=this.get("latitude"),n=this.get("longitude");if(t===void 0||n===void 0||Math.abs(t-r)>.01||Math.abs(n-i)>.01)return this.set(e.coords),s=this.load(),s.done(this.parseResponse),s.fail(this.fetchLocationFromFourSquareFail)},o.prototype.getLocationFail=function(){return this.trigger("setLocation:failed")},o.prototype.fetchLocationFromFourSquareFail=function(){return this.trigger("getLocationName:failed")},o.prototype._parseCity=function(e){return e==="United States"&&s.latitude-this.get("latitude")<=.005?"2nd St., SF":this.countryCityMap[e]},o.prototype.parseResponse=function(e){var t;r.debug("4sq response",e);if(e.meta.code!==200){this.trigger("getLocationName:failed");return}return t=e.response.venues[0].location,this.set({country:t.country,city:this._parseCity(t.country),countryAbbr:this.countryAbbrs[t.country]}),this.save()},o.prototype.load=function(){return $.ajax({dataType:"jsonp",url:this.url()})},o}(n.Model),i})}).call(this)