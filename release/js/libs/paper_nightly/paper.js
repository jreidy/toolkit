/*!
 * Paper.js v0.22
 *
 * This file is part of Paper.js, a JavaScript Vector Graphics Library,
 * based on Scriptographer.org and designed to be largely API compatible.
 * http://paperjs.org/
 * http://scriptographer.org/
 *
 * Copyright (c) 2011, Juerg Lehni & Jonathan Puckey
 * http://lehni.org/ & http://jonathanpuckey.com/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Wed Jul 25 20:02:04 2012 +0200
 *
 ***
 *
 * Bootstrap.js JavaScript Framework.
 * http://bootstrapjs.org/
 *
 * Copyright (c) 2006 - 2011 Juerg Lehni
 * http://lehni.org/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Parse-js
 *
 * A JavaScript tokenizer / parser / generator, originally written in Lisp.
 * Copyright (c) Marijn Haverbeke <marijnh@gmail.com>
 * http://marijn.haverbeke.nl/parse-js/
 *
 * Ported by to JavaScript by Mihai Bazon
 * Copyright (c) 2010, Mihai Bazon <mihai.bazon@gmail.com>
 * http://mihai.bazon.net/blog/
 *
 * Modifications and adaptions to browser (c) 2011, Juerg Lehni
 * http://lehni.org/
 *
 * Distributed under the BSD license.
 */

var paper=new function(){var Base=new function(){function c(e,t,n){if(f)try{return delete e[t],f(e,t,n)}catch(r){}return(n.get||n.set)&&e.__defineGetter__?(n.get&&e.__defineGetter__(t,n.get),n.set&&e.__defineSetter__(t,n.set)):e[t]=n.value,e}function h(e,t){if(l)try{return l(e,t)}catch(n){}var i=e.__lookupGetter__&&e.__lookupGetter__(t);return i?{get:i,set:e.__lookupSetter__(t),enumerable:!0,configurable:!0}:r.call(e,t)?{value:e[t],enumerable:!0,configurable:!0,writable:!0}:null}function p(e,n,i,s,u,a){function p(t,a,p,d){var a=a||(a=h(n,t))&&(a.get?a:a.value),v=typeof a=="function",m=a,g=u||v?a&&a.get?t in e:e[t]:null;d&&v&&(!u||!d[t])&&(d[t]=function(n){return n&&e[t].apply(n,o.call(arguments,1))});if((p||a!==undefined&&r.call(n,t))&&(!u||!g)){if(v){if(g&&/\bthis\.base\b/.test(a)){var y=s&&s[t]==g;m=function(){var e=h(this,"base");c(this,"base",{value:y?s[t]:g,configurable:!0});try{return a.apply(this,arguments)}finally{e?c(this,"base",e):delete this.base}},m.toString=function(){return a.toString()},m.valueOf=function(){return a.valueOf()}}f&&a.length==0&&(l=t.match(/^(get|is)(([A-Z])(.*))$/))&&f.push([l[3].toLowerCase()+l[4],l[2]])}if(!m||v||!m.get)m={value:m,writable:!0};(h(e,t)||{configurable:!0}).configurable&&(m.configurable=!0,m.enumerable=i),c(e,t,m)}}var f,l;if(n){f=[];for(var d in n)r.call(n,d)&&!t.test(d)&&p(d,null,!0,a);p("toString"),p("valueOf");for(var v=0,m=f&&f.length;v<m;v++)try{var l=f[v],g=l[1];p(l[0],{get:e["get"+g]||e["is"+g],set:e["set"+g]},!0)}catch(y){}}return e}function d(t){var n=function(r){e&&c(this,"__proto__",{value:t});if(this.initialize&&r!==n.dont)return this.initialize.apply(this,arguments)};return n.prototype=t,n.toString=function(){return(this.prototype.initialize||function(){}).toString()},n}function v(e){return e?typeof e!="function"?function(t){return t==e}:e:function(e){return e}}function m(e,t,n,r){try{e&&(r||r===undefined&&s(e)?u:a).call(e,v(t),n=n||e)}catch(i){if(i!==Base.stop)throw i}return n}function g(e){return m(e,function(e,t){this[t]=e},new e.constructor)}var e=!this.__proto__,t=/^(statics|generics|preserve|enumerable|prototype|__proto__|toString|valueOf)$/,n=Object.prototype,r=e?function(e){return e!=="__proto__"&&this.hasOwnProperty(e)}:n.hasOwnProperty,i=n.toString,n=Array.prototype,s=Array.isArray=Array.isArray||function(e){return i.call(e)==="[object Array]"},o=n.slice,u=n.forEach||function(e,t){for(var n=0,r=this.length;n<r;n++)e.call(t,this[n],n,this)},a=function(e,t){for(var n in this)this.hasOwnProperty(n)&&e.call(t,this[n],n,this)},f=Object.defineProperty,l=Object.getOwnPropertyDescriptor;return p(function(){},{inject:function(e){if(e){var t=this.prototype,n=t.__proto__&&t.__proto__.constructor,r=e.statics==1?e:e.statics;r!=e&&p(t,e,e.enumerable,n&&n.prototype,e.preserve,e.generics&&this),p(this,r,!0,n,e.preserve)}for(var i=1,s=arguments.length;i<s;i++)this.inject(arguments[i]);return this},extend:function(e){var t=new this(this.dont),n=d(t);return c(t,"constructor",{value:n,writable:!0,configurable:!0}),n.dont={},p(n,this,!0),arguments.length?this.inject.apply(n,arguments):n}},!0).inject({has:r,each:m,inject:function(){for(var e=0,t=arguments.length;e<t;e++)p(this,arguments[e]);return this},extend:function(){var e=new(d(this));return e.inject.apply(e,arguments)},each:function(e,t){return m(this,e,t)},clone:function(){return g(this)},statics:{each:m,clone:g,define:c,describe:h,iterator:v,has:function(e,t){return r.call(e,t)},type:function(e){return(e||e===0)&&(e._type||typeof e)||null},check:function(e){return!!e||e===0},pick:function(){for(var e=0,t=arguments.length;e<t;e++)if(arguments[e]!==undefined)return arguments[e];return null},stop:{}}})};this.Base=Base.inject({generics:!0,clone:function(){return new this.constructor(this)},toString:function(){return"{ "+Base.each(this,function(e,t){if(t.charAt(0)!="_"){var n=typeof e;this.push(t+": "+(n==="number"?Base.formatNumber(e):n==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},statics:{read:function(e,t,n){var t=t||0,n=n||e.length-t,r=e[t];return r instanceof this||this.prototype._readNull&&r==null&&n<=1?r:(r=new this(this.dont),r.initialize.apply(r,t>0||n<e.length?Array.prototype.slice.call(e,t,t+n):e)||r)},readAll:function(e,t){var n=[],r;for(var i=t||0,s=e.length;i<s;i++)n.push(Array.isArray(r=e[i])?this.read(r,0):this.read(e,i,1));return n},splice:function(e,t,n,r){var i=t&&t.length,s=n===undefined;n=s?e.length:n;for(var o=0;o<i;o++)t[o]._index=n+o;if(s)return e.push.apply(e,t),[];var u=[n,r];t&&u.push.apply(u,t);var a=e.splice.apply(e,u);for(var o=0,f=a.length;o<f;o++)delete a[o]._index;for(var o=n+i,f=e.length;o<f;o++)e[o]._index=o;return a},merge:function(){return Base.each(arguments,function(e){Base.each(e,function(e,t){this[t]=e},this)},new Base,!0)},capitalize:function(e){return e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},camelize:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},hyphenate:function(e){return e.replace(/[a-z][A-Z0-9]|[0-9][a-zA-Z]|[A-Z]{2}[a-z]/g,function(e){return e.charAt(0)+"-"+e.substring(1)}).toLowerCase()},formatNumber:function(e){return(Math.round(e*1e5)/1e5).toString()}}});var PaperScope=this.PaperScope=Base.extend({initialize:function(e){paper=this,this.project=null,this.projects=[],this.tools=[],this._id=e&&(e.getAttribute("id")||e.src)||"paperscope-"+PaperScope._id++,e&&e.setAttribute("id",this._id),PaperScope._scopes[this._id]=this},version:.22,getView:function(){return this.project.view},getTool:function(){return this._tool||(this._tool=new Tool),this._tool},evaluate:function(e){var t=PaperScript.evaluate(e,this);return View.updateFocus(),t},install:function(e){var t=this;Base.each(["project","view","tool"],function(n){Base.define(e,n,{configurable:!0,writable:!0,get:function(){return t[n]}})});for(var n in this)!/^(version|_id|load)/.test(n)&&!(n in e)&&(e[n]=this[n])},setup:function(e){paper=this,this.project=new Project(e)},clear:function(){for(var e=this.projects.length-1;e>=0;e--)this.projects[e].remove();for(var e=this.tools.length-1;e>=0;e--)this.tools[e].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},statics:{_scopes:{},_id:0,get:function(e){return typeof e=="object"&&(e=e.getAttribute("id")),this._scopes[e]||null}}}),PaperScopeItem=Base.extend({initialize:function(e){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(e||!this._scope[this._reference])&&this.activate()},activate:function(){return this._scope?(this._scope[this._reference]=this,!0):!1},remove:function(){return this._index==null?!1:(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),Callback={attach:function(e,t){if(typeof e!="string")return Base.each(e,function(e,t){this.attach(t,e)},this);var n=this._eventTypes[e];if(!n)return this;var r=this._handlers=this._handlers||{};return r=r[e]=r[e]||[],r.indexOf(t)==-1&&(r.push(t),n.install&&r.length==1&&n.install.call(this,e)),this},detach:function(e,t){if(typeof e!="string")return Base.each(e,function(e,t){this.detach(t,e)},this);var n=this._eventTypes[e],r=this._handlers&&this._handlers[e],i;return n&&r&&(!t||(i=r.indexOf(t))!=-1&&r.length==1?(n.uninstall&&n.uninstall.call(this,e),delete this._handlers[e]):i!=-1&&r.splice(i,1)),this},fire:function(e,t){var n=this._handlers&&this._handlers[e];return n?(Base.each(n,function(e){e.call(this,t)===!1&&t&&t.stop&&t.stop()},this),!0):!1},responds:function(e){return!!this._handlers&&!!this._handlers[e]},statics:{inject:function(){for(var e=0,t=arguments.length;e<t;e++){var n=arguments[e],r=n._events;if(r){var i={};Base.each(r,function(e,t){var r=typeof e=="string",s=r?e:t,o=Base.capitalize(s),u=s.substring(2).toLowerCase();i[u]=r?{}:e,s="_"+s,n["get"+o]=function(){return this[s]},n["set"+o]=function(e){e?this.attach(u,e):this[s]&&this.detach(u,this[s]),this[s]=e}}),n._eventTypes=i}this.base(n)}return this}}},Point=this.Point=Base.extend({initialize:function(e,t){t!==undefined?(this.x=e,this.y=t):e!==undefined?e==null?this.x=this.y=0:e.x!==undefined?(this.x=e.x,this.y=e.y):e.width!==undefined?(this.x=e.width,this.y=e.height):Array.isArray(e)?(this.x=e[0],this.y=e.length>1?e[1]:e[0]):e.angle!==undefined?(this.x=e.length,this.y=0,this.setAngle(e.angle)):typeof e=="number"?this.x=this.y=e:this.x=this.y=0:this.x=this.y=0},set:function(e,t){return this.x=e,this.y=t,this},clone:function(){return Point.create(this.x,this.y)},toString:function(){var e=Base.formatNumber;return"{ x: "+e(this.x)+", y: "+e(this.y)+" }"},add:function(e){return e=Point.read(arguments),Point.create(this.x+e.x,this.y+e.y)},subtract:function(e){return e=Point.read(arguments),Point.create(this.x-e.x,this.y-e.y)},multiply:function(e){return e=Point.read(arguments),Point.create(this.x*e.x,this.y*e.y)},divide:function(e){return e=Point.read(arguments),Point.create(this.x/e.x,this.y/e.y)},modulo:function(e){return e=Point.read(arguments),Point.create(this.x%e.x,this.y%e.y)},negate:function(){return Point.create(-this.x,-this.y)},transform:function(e){return e?e._transformPoint(this):this},getDistance:function(e,t){e=Point.read(arguments);var n=e.x-this.x,r=e.y-this.y,i=n*n+r*r;return t?i:Math.sqrt(i)},getLength:function(){var e=this.x*this.x+this.y*this.y;return arguments.length&&arguments[0]?e:Math.sqrt(e)},setLength:function(e){if(this.isZero()){var t=this._angle||0;this.set(Math.cos(t)*e,Math.sin(t)*e)}else{var n=e/this.getLength();n==0&&this.getAngle(),this.set(this.x*n,this.y*n)}return this},normalize:function(e){e===undefined&&(e=1);var t=this.getLength(),n=t!=0?e/t:0,r=Point.create(this.x*n,this.y*n);return r._angle=this._angle,r},getAngle:function(){return this.getAngleInRadians(arguments[0])*180/Math.PI},setAngle:function(e){e=this._angle=e*Math.PI/180;if(!this.isZero()){var t=this.getLength();this.set(Math.cos(e)*t,Math.sin(e)*t)}return this},getAngleInRadians:function(){if(arguments[0]===undefined)return this._angle==null&&(this._angle=Math.atan2(this.y,this.x)),this._angle;var e=Point.read(arguments),t=this.getLength()*e.getLength();return t==0?NaN:Math.acos(this.dot(e)/t)},getAngleInDegrees:function(){return this.getAngle(arguments[0])},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3},getDirectedAngle:function(e){return e=Point.read(arguments),Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},rotate:function(e,t){e=e*Math.PI/180;var n=t?this.subtract(t):this,r=Math.sin(e),i=Math.cos(e);return n=Point.create(n.x*i-n.y*r,n.y*i+n.x*r),t?n.add(t):n},equals:function(e){return e=Point.read(arguments),this.x==e.x&&this.y==e.y},isInside:function(e){return e.contains(this)},isClose:function(e,t){return this.getDistance(e)<t},isColinear:function(e){return this.cross(e)<Numerical.TOLERANCE},isOrthogonal:function(e){return this.dot(e)<Numerical.TOLERANCE},isZero:function(){return this.x==0&&this.y==0},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(e){return e=Point.read(arguments),this.x*e.x+this.y*e.y},cross:function(e){return e=Point.read(arguments),this.x*e.y-this.y*e.x},project:function(e){e=Point.read(arguments);if(e.isZero())return Point.create(0,0);var t=this.dot(e)/e.dot(e);return Point.create(e.x*t,e.y*t)},statics:{create:function(e,t){var n=new Point(Point.dont);return n.x=e,n.y=t,n},min:function(e,t){return e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),Point.create(Math.min(e.x,t.x),Math.min(e.y,t.y))},max:function(e,t){return e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),Point.create(Math.max(e.x,t.x),Math.max(e.y,t.y))},random:function(){return Point.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(e){var t=Math[e];this[e]=function(){return Point.create(t(this.x),t(this.y))}},{})}),LinkedPoint=Point.extend({set:function(e,t,n){return this._x=e,this._y=t,n||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},statics:{create:function(e,t,n,r,i){if(i)return Point.create(n,r);var s=new LinkedPoint(LinkedPoint.dont);return s._x=n,s._y=r,s._owner=e,s._setter=t,s}}}),Size=this.Size=Base.extend({initialize:function(e,t){t!==undefined?(this.width=e,this.height=t):e!==undefined?e==null?this.width=this.height=0:e.width!==undefined?(this.width=e.width,this.height=e.height):e.x!==undefined?(this.width=e.x,this.height=e.y):Array.isArray(e)?(this.width=e[0],this.height=e.length>1?e[1]:e[0]):typeof e=="number"?this.width=this.height=e:this.width=this.height=0:this.width=this.height=0},toString:function(){var e=Base.formatNumber;return"{ width: "+e(this.width)+", height: "+e(this.height)+" }"},set:function(e,t){return this.width=e,this.height=t,this},clone:function(){return Size.create(this.width,this.height)},add:function(e){return e=Size.read(arguments),Size.create(this.width+e.width,this.height+e.height)},subtract:function(e){return e=Size.read(arguments),Size.create(this.width-e.width,this.height-e.height)},multiply:function(e){return e=Size.read(arguments),Size.create(this.width*e.width,this.height*e.height)},divide:function(e){return e=Size.read(arguments),Size.create(this.width/e.width,this.height/e.height)},modulo:function(e){return e=Size.read(arguments),Size.create(this.width%e.width,this.height%e.height)},negate:function(){return Size.create(-this.width,-this.height)},equals:function(e){return e=Size.read(arguments),this.width==e.width&&this.height==e.height},isZero:function(){return this.width==0&&this.height==0},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{create:function(e,t){return(new Size(Size.dont)).set(e,t)},min:function(e,t){return Size.create(Math.min(e.width,t.width),Math.min(e.height,t.height))},max:function(e,t){return Size.create(Math.max(e.width,t.width),Math.max(e.height,t.height))},random:function(){return Size.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(e){var t=Math[e];this[e]=function(){return Size.create(t(this.width),t(this.height))}},{})}),LinkedSize=Size.extend({set:function(e,t,n){return this._width=e,this._height=t,n||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)},statics:{create:function(e,t,n,r,i){if(i)return Size.create(n,r);var s=new LinkedSize(LinkedSize.dont);return s._width=n,s._height=r,s._owner=e,s._setter=t,s}}}),Rectangle=this.Rectangle=Base.extend({initialize:function(e,t,n,r){if(arguments.length==4)this.x=e,this.y=t,this.width=n,this.height=r;else if(arguments.length==2)if(t&&t.x!==undefined){var i=Point.read(arguments,0,1),s=Point.read(arguments,1,1);this.x=i.x,this.y=i.y,this.width=s.x-i.x,this.height=s.y-i.y,this.width<0&&(this.x=s.x,this.width=-this.width),this.height<0&&(this.y=s.y,this.height=-this.height)}else{var o=Point.read(arguments,0,1),u=Size.read(arguments,1,1);this.x=o.x,this.y=o.y,this.width=u.width,this.height=u.height}else e?(this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0):this.x=this.y=this.width=this.height=0},set:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},getPoint:function(){return LinkedPoint.create(this,"setPoint",this.x,this.y,arguments[0])},setPoint:function(e){return e=Point.read(arguments),this.x=e.x,this.y=e.y,this},getSize:function(){return LinkedSize.create(this,"setSize",this.width,this.height,arguments[0])},setSize:function(e){return e=Size.read(arguments),this.width=e.width,this.height=e.height,this},getLeft:function(){return this.x},setLeft:function(e){return this.width-=e-this.x,this.x=e,this},getTop:function(){return this.y},setTop:function(e){return this.height-=e-this.y,this.y=e,this},getRight:function(){return this.x+this.width},setRight:function(e){return this.width=e-this.x,this},getBottom:function(){return this.y+this.height},setBottom:function(e){return this.height=e-this.y,this},getCenterX:function(){return this.x+this.width*.5},setCenterX:function(e){return this.x=e-this.width*.5,this},getCenterY:function(){return this.y+this.height*.5},setCenterY:function(e){return this.y=e-this.height*.5,this},getCenter:function(){return LinkedPoint.create(this,"setCenter",this.getCenterX(),this.getCenterY(),arguments[0])},setCenter:function(e){return e=Point.read(arguments),this.setCenterX(e.x).setCenterY(e.y)},equals:function(e){return e=Rectangle.read(arguments),this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height},isEmpty:function(){return this.width==0||this.height==0},toString:function(){var e=Base.formatNumber;return"{ x: "+e(this.x)+", y: "+e(this.y)+", width: "+e(this.width)+", height: "+e(this.height)+" }"},contains:function(e){return e&&e.width!==undefined||(Array.isArray(e)?e:arguments).length==4?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(e){var t=e.x,n=e.y;return t>=this.x&&n>=this.y&&t<=this.x+this.width&&n<=this.y+this.height},_containsRectangle:function(e){var t=e.x,n=e.y;return t>=this.x&&n>=this.y&&t+e.width<=this.x+this.width&&n+e.height<=this.y+this.height},intersects:function(e){return e=Rectangle.read(arguments),e.x+e.width>this.x&&e.y+e.height>this.y&&e.x<this.x+this.width&&e.y<this.y+this.height},intersect:function(e){e=Rectangle.read(arguments);var t=Math.max(this.x,e.x),n=Math.max(this.y,e.y),r=Math.min(this.x+this.width,e.x+e.width),i=Math.min(this.y+this.height,e.y+e.height);return Rectangle.create(t,n,r-t,i-n)},unite:function(e){e=Rectangle.read(arguments);var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.width,e.x+e.width),i=Math.max(this.y+this.height,e.y+e.height);return Rectangle.create(t,n,r-t,i-n)},include:function(e){e=Point.read(arguments);var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.width,e.x),i=Math.max(this.y+this.height,e.y);return Rectangle.create(t,n,r-t,i-n)},expand:function(e,t){return t===undefined&&(t=e),Rectangle.create(this.x-e/2,this.y-t/2,this.width+e,this.height+t)},scale:function(e,t){return this.expand(this.width*e-this.width,this.height*(t===undefined?e:t)-this.height)},statics:{create:function(e,t,n,r){return(new Rectangle(Rectangle.dont)).set(e,t,n,r)}}},new function(){return Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,t){var n=e.join(""),r=/^[RL]/.test(n);t>=4&&(e[1]+=r?"Y":"X");var i=e[r?0:1],s=e[r?1:0],o="get"+i,u="get"+s,a="set"+i,f="set"+s,l="get"+n,c="set"+n;this[l]=function(){return LinkedPoint.create(this,c,this[o](),this[u](),arguments[0])},this[c]=function(e){return e=Point.read(arguments),this[a](e.x)[f](e.y)}},{})}),LinkedRectangle=Rectangle.extend({set:function(e,t,n,r,i){return this._x=e,this._y=t,this._width=n,this._height=r,i||this._owner[this._setter](this),this},statics:{create:function(e,t,n,r,i,s){var o=(new LinkedRectangle(LinkedRectangle.dont)).set(n,r,i,s,!0);return o._owner=e,o._setter=t,o}}},new function(){var e=Rectangle.prototype;return Base.each(["x","y","width","height"],function(e){var t=Base.capitalize(e),n="_"+e;this["get"+t]=function(){return this[n]},this["set"+t]=function(e){this[n]=e,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(t){var n="set"+t;this[n]=function(t){return this._dontNotify=!0,e[n].apply(this,arguments),delete this._dontNotify,this._owner[this._setter](this),this}},{}))}),Matrix=this.Matrix=Base.extend({initialize:function(e){var t=arguments.length,n=!0;t==6?this.set.apply(this,arguments):t==1?e instanceof Matrix?this.set(e._a,e._c,e._b,e._d,e._tx,e._ty):Array.isArray(e)?this.set.apply(this,e):n=!1:t==0?this.setIdentity():n=!1;if(!n)throw new Error("Unsupported matrix parameters")},clone:function(){return Matrix.create(this._a,this._c,this._b,this._d,this._tx,this._ty)},set:function(e,t,n,r,i,s){return this._a=e,this._c=t,this._b=n,this._d=r,this._tx=i,this._ty=s,this},setIdentity:function(){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,this},scale:function(e,t,n){return arguments.length<2||typeof t=="object"?(n=Point.read(arguments,1),t=e):n=Point.read(arguments,2),n&&this.translate(n),this._a*=e,this._c*=e,this._b*=t,this._d*=t,n&&this.translate(n.negate()),this},translate:function(e){e=Point.read(arguments);var t=e.x,n=e.y;return this._tx+=t*this._a+n*this._b,this._ty+=t*this._c+n*this._d,this},rotate:function(e,t){return this.concatenate(Matrix.getRotateInstance.apply(Matrix,arguments))},shear:function(e,t,n){arguments.length<2||typeof t=="object"?(n=Point.read(arguments,1),t=e):n=Point.read(arguments,2),n&&this.translate(n);var r=this._a,i=this._c;return this._a+=t*this._b,this._c+=t*this._d,this._b+=e*r,this._d+=e*i,n&&this.translate(n.negate()),this},toString:function(){var e=Base.formatNumber;return"[["+[e(this._a),e(this._b),e(this._tx)].join(", ")+"], ["+[e(this._c),e(this._d),e(this._ty)].join(", ")+"]]"},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},concatenate:function(e){var t=this._a,n=this._b,r=this._c,i=this._d;return this._a=e._a*t+e._c*n,this._b=e._b*t+e._d*n,this._c=e._a*r+e._c*i,this._d=e._b*r+e._d*i,this._tx+=e._tx*t+e._ty*n,this._ty+=e._tx*r+e._ty*i,this},preConcatenate:function(e){var t=this._a,n=this._b,r=this._c,i=this._d,s=this._tx,o=this._ty;return this._a=e._a*t+e._b*r,this._b=e._a*n+e._b*i,this._c=e._c*t+e._d*r,this._d=e._c*n+e._d*i,this._tx=e._a*s+e._b*o+e._tx,this._ty=e._c*s+e._d*o+e._ty,this},transform:function(e,t,n,r,i){return arguments.length<5?this._transformPoint(Point.read(arguments)):this._transformCoordinates(e,t,n,r,i)},_transformPoint:function(e,t,n){var r=e.x,i=e.y;return t||(t=new Point(Point.dont)),t.set(r*this._a+i*this._b+this._tx,r*this._c+i*this._d+this._ty,n)},_transformCoordinates:function(e,t,n,r,i){var s=t,o=r,u=t+2*i;while(s<u){var a=e[s++],f=e[s++];n[o++]=a*this._a+f*this._b+this._tx,n[o++]=a*this._c+f*this._d+this._ty}return n},_transformCorners:function(e){var t=e.x,n=e.y,r=t+e.width,i=n+e.height,s=[t,n,r,n,r,i,t,i];return this._transformCoordinates(s,0,s,0,4)},_transformBounds:function(e,t,n){var r=this._transformCorners(e),i=r.slice(0,2),s=r.slice(0);for(var o=2;o<8;o++){var u=r[o],a=o&1;u<i[a]?i[a]=u:u>s[a]&&(s[a]=u)}return t||(t=new Rectangle(Rectangle.dont)),t.set(i[0],i[1],s[0]-i[0],s[1]-i[1],n)},inverseTransform:function(e){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var e=this._a*this._d-this._b*this._c;return isFinite(e)&&Math.abs(e)>Numerical.EPSILON&&isFinite(this._tx)&&isFinite(this._ty)?e:null},_inverseTransform:function(e,t,n){var r=this._getDeterminant();if(!r)return null;var i=e.x-this._tx,s=e.y-this._ty;return t||(t=new Point(Point.dont)),t.set((i*this._d-s*this._b)/r,(s*this._a-i*this._c)/r,n)},getTranslation:function(){return Point.create(this._tx,this._ty)},getScaling:function(){var e=Math.sqrt(this._a*this._a+this._c*this._c),t=Math.sqrt(this._b*this._b+this._d*this._d);return Point.create(this._a<0?-e:e,this._b<0?-t:t)},getRotation:function(){var e=-Math.atan2(this._b,this._d),t=Math.atan2(this._c,this._a);return Math.abs(e-t)<Numerical.TOLERANCE?e*180/Math.PI:undefined},equals:function(e){return this._a==e._a&&this._b==e._b&&this._c==e._c&&this._d==e._d&&this._tx==e._tx&&this._ty==e._ty},isIdentity:function(){return this._a==1&&this._c==0&&this._b==0&&this._d==1&&this._tx==0&&this._ty==0},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},createInverse:function(){var e=this._getDeterminant();return e&&Matrix.create(this._d/e,-this._c/e,-this._b/e,this._a/e,(this._b*this._ty-this._d*this._tx)/e,(this._c*this._tx-this._a*this._ty)/e)},createShiftless:function(){return Matrix.create(this._a,this._c,this._b,this._d,0,0)},setToScale:function(e,t){return this.set(e,0,0,t,0,0)},setToTranslation:function(e){return e=Point.read(arguments),this.set(1,0,0,1,e.x,e.y)},setToShear:function(e,t){return this.set(1,t,e,1,0,0)},setToRotation:function(e,t){t=Point.read(arguments,1),e=e*Math.PI/180;var n=t.x,r=t.y,i=Math.cos(e),s=Math.sin(e);return this.set(i,s,-s,i,n-n*i+r*s,r-n*s-r*i)},applyToContext:function(e,t){return e[t?"setTransform":"transform"](this._a,this._c,this._b,this._d,this._tx,this._ty),this},statics:{create:function(e,t,n,r,i,s){return(new Matrix(Matrix.dont)).set(e,t,n,r,i,s)},getScaleInstance:function(e,t){var n=new Matrix;return n.setToScale.apply(n,arguments)},getTranslateInstance:function(e){var t=new Matrix;return t.setToTranslation.apply(t,arguments)},getShearInstance:function(e,t,n){var r=new Matrix;return r.setToShear.apply(r,arguments)},getRotateInstance:function(e,t){var n=new Matrix;return n.setToRotation.apply(n,arguments)}}},new function(){return Base.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(e,t){t=Base.capitalize(t),this["get"+t]=function(){return this[e]},this["set"+t]=function(t){this[e]=t}},{})}),Line=this.Line=Base.extend({initialize:function(e,t,n){e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),arguments.length==3?(this.point=e,this.vector=t.subtract(e),this.infinite=n):(this.point=e,this.vector=t,this.infinite=!0)},intersect:function(e){var t=this.vector.cross(e.vector);if(Math.abs(t)<=Numerical.EPSILON)return null;var n=e.point.subtract(this.point),r=n.cross(e.vector)/t,i=n.cross(this.vector)/t;return(this.infinite||0<=r&&r<=1)&&(e.infinite||0<=i&&i<=1)?this.point.add(this.vector.multiply(r)):null},getSide:function(e){var t=this.vector,n=e.subtract(this.point),r=n.cross(t);return r==0&&(r=n.dot(t),r>0&&(r=n.subtract(t).dot(t),r<0&&(r=0))),r<0?-1:r>0?1:0},getDistance:function(e){var t=this.vector.y/this.vector.x,n=this.point.y-t*this.point.x,r=Math.abs(e.y-t*e.x-n)/Math.sqrt(t*t+1);return this.infinite?r:Math.min(r,e.getDistance(this.point),e.getDistance(this.point.add(this.vector)))}}),Project=this.Project=PaperScopeItem.extend({_list:"projects",_reference:"project",initialize:function(e){this.base(!0),this._currentStyle=new PathStyle,this._selectedItems={},this._selectedItemCount=0,this.layers=[],this.symbols=[],this.activeLayer=new Layer,e&&(this.view=e instanceof View?e:View.create(e))},_needsRedraw:function(){this.view&&(this.view._redrawNeeded=!0)},remove:function(){return this.base()?(this.view&&this.view.remove(),!0):!1},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.initialize(e)},getIndex:function(){return this._index},getSelectedItems:function(){var e=[];return Base.each(this._selectedItems,function(t){e.push(t)}),e},_updateSelection:function(e){e._selected?(this._selectedItemCount++,this._selectedItems[e._id]=e):(this._selectedItemCount--,delete this._selectedItems[e._id])},selectAll:function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].setSelected(!0)},deselectAll:function(){for(var e in this._selectedItems)this._selectedItems[e].setSelected(!1)},hitTest:function(e,t){t=HitResult.getOptions(e,t),e=t.point;for(var n=this.layers.length-1;n>=0;n--){var r=this.layers[n].hitTest(e,t);if(r)return r}return null},draw:function(e,t){e.save(),t.isIdentity()||t.applyToContext(e);var n={offset:new Point(0,0)};for(var r=0,i=this.layers.length;r<i;r++)Item.draw(this.layers[r],e,n);e.restore();if(this._selectedItemCount>0){e.save(),e.strokeWidth=1,e.strokeStyle=e.fillStyle="#009dec";var s={};function o(e,t,n){var r=n&&s[e._id];return r?(t.concatenate(r),t):(e._parent?(o(e._parent,t,!0),e._matrix.isIdentity()||t.concatenate(e._matrix)):t.initialize(e._matrix),n&&(s[e._id]=t.clone()),t)}for(var u in this._selectedItems){var a=this._selectedItems[u];a.drawSelected(e,o(a,t.clone()))}e.restore()}}}),Symbol=this.Symbol=Base.extend({initialize:function(e){this.project=paper.project,this.project.symbols.push(this),this.setDefinition(e),this._instances={}},_changed:function(e){Base.each(this._instances,function(t){t._changed(e)})},getDefinition:function(){return this._definition},setDefinition:function(e){e._parentSymbol&&(e=e.clone()),this._definition&&delete this._definition._parentSymbol,this._definition=e,e.remove(),e.setPosition(new Point),e._parentSymbol=this,this._changed(Change.GEOMETRY)},place:function(e){return new PlacedSymbol(this,e)},clone:function(){return new Symbol(this._definition.clone())}}),ChangeFlag={APPEARANCE:1,HIERARCHY:2,GEOMETRY:4,STROKE:8,STYLE:16,ATTRIBUTE:32,CONTENT:64,PIXELS:128,CLIPPING:256},Change={HIERARCHY:ChangeFlag.HIERARCHY|ChangeFlag.APPEARANCE,GEOMETRY:ChangeFlag.GEOMETRY|ChangeFlag.APPEARANCE,STROKE:ChangeFlag.STROKE|ChangeFlag.STYLE|ChangeFlag.APPEARANCE,STYLE:ChangeFlag.STYLE|ChangeFlag.APPEARANCE,ATTRIBUTE:ChangeFlag.ATTRIBUTE|ChangeFlag.APPEARANCE,CONTENT:ChangeFlag.CONTENT|ChangeFlag.APPEARANCE,PIXELS:ChangeFlag.PIXELS|ChangeFlag.APPEARANCE},Item=this.Item=Base.extend(Callback,{_events:new function(){function r(e){for(var t=0,r=n.length;t<r;t++)n[t].fire("frame",e)}var e={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},t={install:function(t){var n=this._project.view._eventCounters;if(n)for(var r in e)n[r]=(n[r]||0)+(e[r][t]||0)},uninstall:function(t){var n=this._project.view._eventCounters;if(n)for(var r in e)n[r]-=e[r][t]||0}},n=[];return Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(e){this[e]=t},{onFrame:{install:function(){n.length||this._project.view.attach("frame",r),n.push(this)},uninstall:function(){n.splice(n.indexOf(this),1),n.length||this._project.view.detach("frame",r)}}})},initialize:function(e){this._id=++Item._id,this._project||paper.project.activeLayer.addChild(this),this._style||(this._style=PathStyle.create(this)),this.setStyle(this._project.getCurrentStyle()),this._matrix=e!==undefined?e instanceof Matrix?e.clone():(new Matrix).translate(Point.read(arguments,0)):new Matrix},_changed:function(e){e&ChangeFlag.GEOMETRY&&(delete this._bounds,delete this._position),this._parent&&e&(ChangeFlag.GEOMETRY|ChangeFlag.STROKE)&&this._parent._clearBoundsCache(),e&ChangeFlag.HIERARCHY&&this._clearBoundsCache(),e&ChangeFlag.APPEARANCE&&this._project._needsRedraw(),this._parentSymbol&&this._parentSymbol._changed(e);if(this._project._changes){var t=this._project._changesById[this._id];t?t.flags|=e:(t={item:this,flags:e},this._project._changesById[this._id]=t,this._project._changes.push(t))}},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){this._name&&this._removeFromNamed(),this._name=e||undefined;if(e&&this._parent){var t=this._parent._children,n=this._parent._namedChildren;(n[e]=n[e]||[]).push(this),t[e]=this}this._changed(ChangeFlag.ATTRIBUTE)},statics:{_id:0}},Base.each(["locked","visible","blendMode","opacity","guide"],function(e){var t=Base.capitalize(e),e="_"+e;this["get"+t]=function(){return this[e]},this["set"+t]=function(t){t!=this[e]&&(this[e]=t,this._changed(e==="_locked"?ChangeFlag.ATTRIBUTE:Change.ATTRIBUTE))}},{}),{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._children)for(var e=0,t=this._children.length;e<t;e++)if(this._children[e].isSelected())return!0;return this._selected},setSelected:function(e){if(this._children&&!arguments[1])for(var t=0,n=this._children.length;t<n;t++)this._children[t].setSelected(e);else(e=!!e)!=this._selected&&(this._selected=e,this._project._updateSelection(this),this._changed(Change.ATTRIBUTE))},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var e=0,t=this._children.length;e<t;e++)if(!this._children[e].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(e){if(this._children)for(var t=0,n=this._children.length;t<n;t++)this._children[t].setFullySelected(e);this.setSelected(e,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(Change.ATTRIBUTE),this._parent&&this._parent._changed(ChangeFlag.CLIPPING))},_clipMask:!1,getPosition:function(){var e=this._position||(this._position=this.getBounds().getCenter(!0));return arguments[0]?e:LinkedPoint.create(this,"setPosition",e.x,e.y)},setPosition:function(e){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getMatrix:function(){return this._matrix},setMatrix:function(e){this._matrix.initialize(e),this._changed(Change.GEOMETRY)}},Base.each(["bounds","strokeBounds","handleBounds","roughBounds"],function(e){this["get"+Base.capitalize(e)]=function(){var t=this._boundsType,n=this._getCachedBounds(typeof t=="string"?t:t&&t[e]||e,arguments[0]);return e=="bounds"?LinkedRectangle.create(this,"setBounds",n.x,n.y,n.width,n.height):n}},{_getCachedBounds:function(e,t,n){var r=(!t||t.equals(this._matrix))&&e;if(n&&this._parent){var i=n._id,s=this._parent._boundsCache=this._parent._boundsCache||{ids:{},list:[]};s.ids[i]||(s.list.push(n),s.ids[i]=n)}if(r&&this._bounds&&this._bounds[r])return this._bounds[r];var o=this._matrix.isIdentity();t=!t||t.isIdentity()?o?null:this._matrix:o?t:t.clone().concatenate(this._matrix);var u=this._getBounds(e,t,r?this:n);return r&&(this._bounds||(this._bounds={}),this._bounds[r]=u.clone()),u},_clearBoundsCache:function(){if(this._boundsCache){for(var e=0,t=this._boundsCache.list,n=t.length;e<n;e++){var r=t[e];delete r._bounds,r!=this&&r._boundsCache&&r._clearBoundsCache()}delete this._boundsCache}},_getBounds:function(e,t,n){var r=this._children;if(!r||r.length==0)return new Rectangle;var i=Infinity,s=-i,o=i,u=s;for(var a=0,f=r.length;a<f;a++){var l=r[a];if(l._visible){var c=l._getCachedBounds(e,t,n);i=Math.min(c.x,i),o=Math.min(c.y,o),s=Math.max(c.x+c.width,s),u=Math.max(c.y+c.height,u)}}return Rectangle.create(i,o,s-i,u-o)},setBounds:function(e){e=Rectangle.read(arguments);var t=this.getBounds(),n=new Matrix,r=e.getCenter();n.translate(r),(e.width!=t.width||e.height!=t.height)&&n.scale(t.width!=0?e.width/t.width:1,t.height!=0?e.height/t.height:1),r=t.getCenter(),n.translate(-r.x,-r.y),this.transform(n)}}),{getProject:function(){return this._project},_setProject:function(e){if(this._project!=e){this._project=e;if(this._children)for(var t=0,n=this._children.length;t<n;t++)this._children[t]._setProject(e)}},getLayer:function(){var e=this;while(e=e._parent)if(e instanceof Layer)return e;return null},getParent:function(){return this._parent},getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},clone:function(){return this._clone(new this.constructor)},_clone:function(e){e.setStyle(this._style);if(this._children)for(var t=0,n=this._children.length;t<n;t++)e.addChild(this._children[t].clone());var r=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"];for(var t=0,n=r.length;t<n;t++){var i=r[t];this.hasOwnProperty(i)&&(e[i]=this[i])}return e._matrix.initialize(this._matrix),e.setSelected(this._selected),this._name&&e.setName(this._name),e},copyTo:function(e){var t=this.clone();return e.layers?e.activeLayer.addChild(t):e.addChild(t),t},rasterize:function(e){var t=this.getStrokeBounds(),n=(e||72)/72,r=CanvasProvider.getCanvas(t.getSize().multiply(n)),i=r.getContext("2d"),s=(new Matrix).scale(n).translate(-t.x,-t.y);s.applyToContext(i),this.draw(i,{});var o=new Raster(r);return o.setBounds(t),o},hitTest:function(e,t){t=HitResult.getOptions(e,t),e=t.point=this._matrix._inverseTransform(t.point);if(!this._children&&!this.getRoughBounds().expand(t.tolerance)._containsPoint(e))return null;if((t.center||t.bounds)&&!(this instanceof Layer&&!this._parent)){var n=this.getBounds(),r=this,i=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],s;function o(i,s){var o=n["get"+s]();if(e.getDistance(o)<t.tolerance)return new HitResult(i,r,{name:Base.hyphenate(s),point:o})}if(t.center&&(s=o("center","Center")))return s;if(t.bounds)for(var u=0;u<8;u++)if(s=o("bounds",i[u]))return s}return this._children||!(t.guides&&!this._guide||t.selected&&!this._selected)?this._hitTest(e,t):null},_hitTest:function(e,t){if(this._children)for(var n=this._children.length-1;n>=0;n--){var r=this._children[n].hitTest(e,t);if(r)return r}},addChild:function(e){return this.insertChild(undefined,e)},insertChild:function(e,t){return this._children?(t._remove(!1,!0),Base.splice(this._children,[t],e,0),t._parent=this,t._setProject(this._project),t._name&&t.setName(t._name),this._changed(Change.HIERARCHY),!0):!1},addChildren:function(e){for(var t=0,n=e&&e.length;t<n;t++)this.insertChild(undefined,e[t])},insertChildren:function(e,t){for(var n=0,r=t&&t.length;n<r;n++)this.insertChild(e,t[n])&&e++},insertAbove:function(e){var t=e._index;return e._parent==this._parent&&t<this._index&&t++,e._parent.insertChild(t,this)},insertBelow:function(e){var t=e._index;return e._parent==this._parent&&t>this._index&&t--,e._parent.insertChild(t,this)},appendTop:function(e){return this.addChild(e)},appendBottom:function(e){return this.insertChild(0,e)},moveAbove:function(e){return this.insertAbove(e)},moveBelow:function(e){return this.insertBelow(e)},_removeFromNamed:function(){var e=this._parent._children,t=this._parent._namedChildren,n=this._name,r=t[n],i=r?r.indexOf(this):-1;if(i==-1)return;e[n]==this&&delete e[n],r.splice(i,1),r.length?e[n]=r[r.length-1]:delete t[n]},_remove:function(e,t){return this._parent?(e&&this.setSelected(!1),this._name&&this._removeFromNamed(),this._index!=null&&Base.splice(this._parent._children,null,this._index,1),t&&this._parent._changed(Change.HIERARCHY),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},removeChildren:function(e,t){if(!this._children)return null;e=e||0,t=Base.pick(t,this._children.length);var n=Base.splice(this._children,null,e,t-e);for(var r=n.length-1;r>=0;r--)n[r]._remove(!0,!1);return n.length>0&&this._changed(Change.HIERARCHY),n},reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,t=this._children.length;e<t;e++)this._children[e]._index=e;this._changed(Change.HIERARCHY)}},isEditable:function(){var e=this;while(e){if(!e._visible||e._locked)return!1;e=e._parent}return!0},_getOrder:function(e){function t(e){var t=[];do t.unshift(e);while(e=e._parent);return t}var n=t(this),r=t(e);for(var i=0,s=Math.min(n.length,r.length);i<s;i++)if(n[i]!=r[i])return n[i]._index<r[i]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isAbove:function(e){return this._getOrder(e)==-1},isBelow:function(e){return this._getOrder(e)==1},isParent:function(e){return this._parent==e},isChild:function(e){return e&&e._parent==this},isDescendant:function(e){var t=this;while(t=t._parent)if(t==e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isGroupedWith:function(e){var t=this._parent;while(t){if(t._parent&&(t instanceof Group||t instanceof CompoundPath)&&e.isDescendant(t))return!0;t=t._parent}return!1},scale:function(e,t,n,r){if(arguments.length<2||typeof t=="object")r=n,n=t,t=e;return this.transform((new Matrix).scale(e,t,n||this.getPosition(!0)),r)},translate:function(e,t){var n=new Matrix;return this.transform(n.translate.apply(n,arguments),t)},rotate:function(e,t,n){return this.transform((new Matrix).rotate(e,t||this.getPosition(!0)),n)},shear:function(e,t,n,r){if(arguments.length<2||typeof t=="object")r=n,n=t,t=e;return this.transform((new Matrix).shear(e,t,n||this.getPosition(!0)),r)},transform:function(e,t){var n=this._bounds,r=this._position;this._matrix.preConcatenate(e),this._transform&&this._transform(e),t&&this.apply(),this._changed(Change.GEOMETRY);if(n&&e.getRotation()%90===0){for(var i in n){var s=n[i];e._transformBounds(s,s)}var o=this._boundsType,s=n[o&&o.bounds||"bounds"];s&&(this._position=s.getCenter(!0)),this._bounds=n}else r&&(this._position=e._transformPoint(r,r));return this},apply:function(){this._apply(this._matrix)&&this._matrix.setIdentity()},_apply:function(e){if(this._children){for(var t=0,n=this._children.length;t<n;t++){var r=this._children[t];r.transform(e),r.apply()}return!0}},fitBounds:function(e,t){e=Rectangle.read(arguments);var n=this.getBounds(),r=n.height/n.width,i=e.height/e.width,s=(t?r>i:r<i)?e.width/n.width:e.height/n.height,o=new Rectangle(new Point,Size.create(n.width*s,n.height*s));o.setCenter(e.getCenter()),this.setBounds(o)},toString:function(){return(this.constructor._name||"Item")+(this._name?" '"+this._name+"'":" @"+this._id)},_setStyles:function(e){var t=this._style,n=t._strokeWidth,r=t._strokeJoin,i=t._strokeCap,s=t._miterLimit,o=t._fillColor,u=t._strokeColor;n!=null&&(e.lineWidth=n),r&&(e.lineJoin=r),i&&(e.lineCap=i),s&&(e.miterLimit=s),o&&(e.fillStyle=o.getCanvasStyle(e)),u&&(e.strokeStyle=u.getCanvasStyle(e));if(!o||!u)e.globalAlpha=this._opacity},statics:{drawSelectedBounds:function(e,t,n){var r=n._transformCorners(e);t.beginPath();for(var i=0;i<8;i++)t[i==0?"moveTo":"lineTo"](r[i],r[++i]);t.closePath(),t.stroke();for(var i=0;i<8;i++)t.beginPath(),t.rect(r[i]-2,r[++i]-2,4,4),t.fill()},draw:function(e,t,n){if(!e._visible||e._opacity==0)return;var r,i,s,o;if(e._blendMode!=="normal"||e._opacity<1&&(!e._segments||!!e.getFillColor()&&!!e.getStrokeColor())){var u=e.getStrokeBounds();if(!u.width||!u.height)return;o=n.offset,i=t,s=n.offset=u.getTopLeft().floor(),r=CanvasProvider.getCanvas(u.getSize().ceil().add(Size.create(1,1))),t=r.getContext("2d")}n.clipping||t.save(),r&&t.translate(-s.x,-s.y),e._matrix.applyToContext(t),e.draw(t,n),n.clipping||t.restore(),r&&(n.offset=o,e._blendMode!=="normal"?BlendMode.process(e._blendMode,t,i,e._opacity,s.subtract(o)):(i.save(),i.globalAlpha=e._opacity,i.drawImage(r,s.x,s.y),i.restore()),CanvasProvider.returnCanvas(r))}}},Base.each(["down","drag","up","move"],function(e){this["removeOn"+Base.capitalize(e)]=function(){var t={};return t[e]=!0,this.removeOn(t)}},{removeOn:function(e){for(var t in e)if(e[t]){var n="mouse"+t,r=Tool._removeSets=Tool._removeSets||{};r[n]=r[n]||{},r[n][this._id]=this}return this}})),Group=this.Group=Item.extend({initialize:function(e){this.base(),this._children=[],this._namedChildren={},this.addChildren(!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e)},_changed:function(e){Item.prototype._changed.call(this,e),e&(ChangeFlag.HIERARCHY|ChangeFlag.CLIPPING)&&delete this._clipItem},_getClipItem:function(){if(this._clipItem!==undefined)return this._clipItem;for(var e=0,t=this._children.length;e<t;e++){var n=this._children[e];if(n._clipMask)return this._clipItem=n}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var t=this.getFirstChild();return t&&t.setClipMask(e),this},draw:function(e,t){var n=this._getClipItem();n&&(t.clipping=!0,Item.draw(n,e,t),delete t.clipping);for(var r=0,i=this._children.length;r<i;r++){var s=this._children[r];s!=n&&Item.draw(s,e,t)}}}),Layer=this.Layer=Group.extend({initialize:function(e){this._project=paper.project,this._index=this._project.layers.push(this)-1,this.base.apply(this,arguments),this.activate()},_remove:function(e,t){return this._parent?this.base(e,t):this._index!=null?(e&&this.setSelected(!1),Base.splice(this._project.layers,null,this._index,1),this._project._needsRedraw(),!0):!1},getNextSibling:function(){return this._parent?this.base():this._project.layers[this._index+1]||null},getPreviousSibling:function(){return this._parent?this.base():this._project.layers[this._index-1]||null},activate:function(){this._project.activeLayer=this}},new function(){function e(e){return function(t){return t instanceof Layer&&!t._parent&&this._remove(!1,!0)?(Base.splice(t._project.layers,[this],t._index+(e?1:-1),0),this._setProject(t._project),!0):this.base(t)}}return{insertAbove:e(!0),insertBelow:e(!1)}}),PlacedItem=this.PlacedItem=Item.extend({_boundsType:{bounds:"strokeBounds"}}),Raster=this.Raster=PlacedItem.extend({_boundsType:"bounds",initialize:function(e,t){this.base(t),e.getContext?this.setCanvas(e):(typeof e=="string"&&(e=document.getElementById(e)),this.setImage(e))},clone:function(){var e=this._image;e||(e=CanvasProvider.getCanvas(this._size),e.getContext("2d").drawImage(this._canvas,0,0));var t=new Raster(e);return this._clone(t)},getSize:function(){return this._size},setSize:function(){var e=Size.read(arguments),t=this.getImage();this.setCanvas(CanvasProvider.getCanvas(e)),this.getContext(!0).drawImage(t,0,0,e.width,e.height)},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},getPpi:function(){var e=this._matrix,t=(new Point(0,0)).transform(e),n=(new Point(1,0)).transform(e).subtract(t),r=(new Point(0,1)).transform(e).subtract(t);return Size.create(72/n.getLength(),72/r.getLength())},getContext:function(){return this._context||(this._context=this.getCanvas().getContext("2d")),arguments[0]&&this._changed(Change.PIXELS),this._context},setContext:function(e){this._context=e},getCanvas:function(){return this._canvas||(this._canvas=CanvasProvider.getCanvas(this._size),this._image&&this.getContext(!0).drawImage(this._image,0,0)),this._canvas},setCanvas:function(e){this._canvas&&CanvasProvider.returnCanvas(this._canvas),this._canvas=e,this._size=Size.create(e.width,e.height),this._image=null,this._context=null,this._changed(Change.GEOMETRY|Change.PIXELS)},getImage:function(){return this._image||this.getCanvas()},setImage:function(e){this._canvas&&CanvasProvider.returnCanvas(this._canvas),this._image=e,this._size=Size.create(e.naturalWidth,e.naturalHeight),this._canvas=null,this._context=null,this._changed(Change.GEOMETRY)},getSubImage:function(e){e=Rectangle.read(arguments);var t=CanvasProvider.getCanvas(e.getSize());return t.getContext("2d").drawImage(this.getCanvas(),e.x,e.y,t.width,t.height,0,0,t.width,t.height),t},drawImage:function(e,t){t=Point.read(arguments,1),this.getContext(!0).drawImage(e,t.x,t.y)},getAverageColor:function(e){var t,n;e?e instanceof PathItem?(n=e,t=e.getBounds()):e.width?t=new Rectangle(e):e.x&&(t=Rectangle.create(e.x-.5,e.y-.5,1,1)):t=this.getBounds();var r=32,i=Math.min(t.width,r),s=Math.min(t.height,r),o=Raster._sampleContext;o?o.clearRect(0,0,r,r):o=Raster._sampleContext=CanvasProvider.getCanvas(new Size(r)).getContext("2d"),o.save(),o.scale(i/t.width,s/t.height),o.translate(-t.x,-t.y),n&&n.draw(o,{clip:!0}),this._matrix.applyToContext(o),o.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2),o.restore();var u=o.getImageData(.5,.5,Math.ceil(i),Math.ceil(s)).data,a=[0,0,0],f=0;for(var l=0,c=u.length;l<c;l+=4){var h=u[l+3];f+=h,h/=255,a[0]+=u[l]*h,a[1]+=u[l+1]*h,a[2]+=u[l+2]*h}for(var l=0;l<3;l++)a[l]/=f;return f?Color.read(a):null},getPixel:function(e){e=Point.read(arguments);var t=this.getContext().getImageData(e.x,e.y,1,1).data,n=new Array(4);for(var r=0;r<4;r++)n[r]=t[r]/255;return RgbColor.read(n)},setPixel:function(e,t){var n=arguments.length==2;e=Point.read(arguments,0,n?1:2),t=Color.read(arguments,n?1:2);var r=this.getContext(!0),i=r.createImageData(1,1),s=t.getAlpha();i.data[0]=t.getRed()*255,i.data[1]=t.getGreen()*255,i.data[2]=t.getBlue()*255,i.data[3]=s!=null?s*255:255,r.putImageData(i,e.x,e.y)},createData:function(e){return e=Size.read(arguments),this.getContext().createImageData(e.width,e.height)},getData:function(e){return e=Rectangle.read(arguments),e.isEmpty()&&(e=new Rectangle(this.getSize())),this.getContext().getImageData(e.x,e.y,e.width,e.height)},setData:function(e,t){t=Point.read(arguments,1),this.getContext(!0).putImageData(e,t.x,t.y)},_getBounds:function(e,t){var n=(new Rectangle(this._size)).setCenter(0,0);return t?t._transformBounds(n):n},_hitTest:function(e,t){if(e.isInside(this._getBounds())){var n=this;return new HitResult("pixel",n,{offset:e.add(n._size.divide(2)).round(),getColor:function(){return n.getPixel(this.offset)}})}},draw:function(e,t){e.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2)},drawSelected:function(e,t){Item.drawSelectedBounds((new Rectangle(this._size)).setCenter(0,0),e,t)}}),PlacedSymbol=this.PlacedSymbol=PlacedItem.extend({initialize:function(e,t){this.base(t),this.setSymbol(e instanceof Symbol?e:new Symbol(e))},getSymbol:function(){return this._symbol},setSymbol:function(e){this._symbol&&delete this._symbol._instances[this._id],this._symbol=e,e._instances[this._id]=this},clone:function(){return this._clone(new PlacedSymbol(this.symbol,this._matrix.clone()))},_getBounds:function(e,t){return this.symbol._definition._getCachedBounds(e,t)},draw:function(e,t){Item.draw(this.symbol._definition,e,t)},drawSelected:function(e,t){Item.drawSelectedBounds(this.symbol._definition.getBounds(),e,t)}});HitResult=Base.extend({initialize:function(e,t,n){this.type=e,this.item=t,n&&this.inject(n)},statics:{getOptions:function(e,t){return t&&t._merged?t:Base.merge({point:Point.read(arguments,0,1),type:null,tolerance:2,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},t)}}});var Segment=this.Segment=Base.extend({initialize:function(e,t,n,r,i,s){var o=arguments.length,u=SegmentPoint.create,a,f,l;o!=0&&(o==1?e.point?(a=e.point,f=e.handleIn,l=e.handleOut):a=e:o<6?o==2&&t.x===undefined?a=[e,t]:(a=e,f=t,l=n):o==6&&(a=[e,t],f=[n,r],l=[i,s])),u(this,"_point",a),u(this,"_handleIn",f),u(this,"_handleOut",l)},_changed:function(e){if(!this._path)return;var t=this._path._curves&&this.getCurve(),n;t&&(t._changed(),(n=t[e==this._point||e==this._handleIn&&t._segment1==this?"getPrevious":"getNext"]())&&n._changed()),this._path._changed(Change.GEOMETRY)},getPoint:function(){return this._point},setPoint:function(e){e=Point.read(arguments),this._point.set(e.x,e.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(e){e=Point.read(arguments),this._handleIn.set(e.x,e.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(e){e=Point.read(arguments),this._handleOut.set(e.x,e.y)},_isSelected:function(e){var t=this._selectionState;return e==this._point?!!(t&SelectionState.POINT):e==this._handleIn?!!(t&SelectionState.HANDLE_IN):e==this._handleOut?!!(t&SelectionState.HANDLE_OUT):!1},_setSelected:function(e,t){var n=this._path,t=!!t,r=this._selectionState||0,i=[!!(r&SelectionState.POINT),!!(r&SelectionState.HANDLE_IN),!!(r&SelectionState.HANDLE_OUT)];if(e==this._point){if(t)i[1]=i[2]=!1;else{var s=this.getPrevious(),o=this.getNext();i[1]=s&&(s._point.isSelected()||s._handleOut.isSelected()),i[2]=o&&(o._point.isSelected()||o._handleIn.isSelected())}i[0]=t}else{var u=e==this._handleIn?1:2;i[u]!=t&&(t&&(i[0]=!1),i[u]=t,n._changed(Change.ATTRIBUTE))}this._selectionState=(i[0]?SelectionState.POINT:0)|(i[1]?SelectionState.HANDLE_IN:0)|(i[2]?SelectionState.HANDLE_OUT:0),n&&r!=this._selectionState&&n._updateSelection(this,r,this._selectionState)},isSelected:function(){return this._isSelected(this._point)},setSelected:function(e){this._setSelected(this._point,e)},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){if(this._path){var e=this._index;return!this._path._closed&&e==this._path._segments.length-1&&e--,this._path.getCurves()[e]||null}return null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},reverse:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(e){return e==this||e&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},_transformCoordinates:function(e,t,n){var r=this._point,i=!n||!this._handleIn.isZero()?this._handleIn:null,s=!n||!this._handleOut.isZero()?this._handleOut:null,o=r._x,u=r._y,a=2;t[0]=o,t[1]=u,i&&(t[a++]=i._x+o,t[a++]=i._y+u),s&&(t[a++]=s._x+o,t[a++]=s._y+u);if(!e)return;e._transformCoordinates(t,0,t,0,a/2),o=t[0],u=t[1],n?(r._x=o,r._y=u,a=2,i&&(i._x=t[a++]-o,i._y=t[a++]-u),s&&(s._x=t[a++]-o,s._y=t[a++]-u)):(i||(t[a++]=o,t[a++]=u),s||(t[a++]=o,t[a++]=u))}}),SegmentPoint=Point.extend({set:function(e,t){return this._x=e,this._y=t,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){return this._x==0&&this._y==0},setSelected:function(e){this._owner._setSelected(this,e)},isSelected:function(){return this._owner._isSelected(this)},statics:{create:function(e,t,n){var r=new SegmentPoint(SegmentPoint.dont),i,s,o;return n?(i=n[0])!==undefined?s=n[1]:((i=n.x)===undefined&&(n=Point.read(arguments,2,1),i=n.x),s=n.y,o=n.selected):i=s=0,r._x=i,r._y=s,r._owner=e,e[t]=r,o&&r.setSelected(!0),r}}}),SelectionState={HANDLE_IN:1,HANDLE_OUT:2,POINT:4},Curve=this.Curve=Base.extend({initialize:function(e,t,n,r,i,s,o,u){var a=arguments.length;if(a==0)this._segment1=new Segment,this._segment2=new Segment;else if(a==1)this._segment1=new Segment(e.segment1),this._segment2=new Segment(e.segment2);else if(a==2)this._segment1=new Segment(e),this._segment2=new Segment(t);else if(a==4)this._segment1=new Segment(e,null,t),this._segment2=new Segment(r,n,null);else if(a==8){var f=Point.create(e,t),l=Point.create(o,u);this._segment1=new Segment(f,null,Point.create(n,r).subtract(f)),this._segment2=new Segment(l,Point.create(i,s).subtract(l),null)}},_changed:function(){delete this._length},getPoint1:function(){return this._segment1._point},setPoint1:function(e){e=Point.read(arguments),this._segment1._point.set(e.x,e.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(e){e=Point.read(arguments),this._segment2._point.set(e.x,e.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(e){e=Point.read(arguments),this._segment1._handleOut.set(e.x,e.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(e){e=Point.read(arguments),this._segment2._handleIn.set(e.x,e.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(e){this.getHandle1().setSelected(e),this.getHandle2().setSelected(e)},getValues:function(){return Curve.getValues(this._segment1,this._segment2)},getPoints:function(){var e=this.getValues(),t=[];for(var n=0;n<8;n+=2)t.push(Point.create(e[n],e[n+1]));return t},getLength:function(){var e=arguments[0],t=arguments[1];fullLength=arguments.length==0||e==0&&t==1;if(fullLength&&this._length!=null)return this._length;var n=Curve.getLength(this.getValues(),e,t);return fullLength&&(this._length=n),n},getPart:function(e,t){return new Curve(Curve.getPart(this.getValues(),e,t))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getParameterAt:function(e,t){return Curve.getParameterAt(this.getValues(),e,t!==undefined?t:e<0?1:0)},getPoint:function(e){return Curve.evaluate(this.getValues(),e,0)},getTangent:function(e){return Curve.evaluate(this.getValues(),e,1)},getNormal:function(e){return Curve.evaluate(this.getValues(),e,2)},getParameter:function(e){return e=Point.read(e),Curve.getParameter(this.getValues(),e.x,e.y)},getCrossings:function(e,t){var n=this.getValues(),r=Curve.solveCubic(n,1,e.y,t),i=0;for(var s=0;s<r;s++){var o=t[s];if(o>=0&&o<1&&Curve.evaluate(n,o,0).x>e.x){if(o<Numerical.TOLERANCE&&Curve.evaluate(this.getPrevious().getValues(),1,1).y*Curve.evaluate(n,o,1).y>=0)continue;i++}}return i},reverse:function(){return new Curve(this._segment2.reverse(),this._segment1.reverse())},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},statics:{create:function(e,t,n){var r=new Curve(Curve.dont);return r._path=e,r._segment1=t,r._segment2=n,r},getValues:function(e,t){var n=e._point,r=e._handleOut,i=t._handleIn,s=t._point;return[n._x,n._y,n._x+r._x,n._y+r._y,s._x+i._x,s._y+i._y,s._x,s._y]},evaluate:function(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c,h;if(n!=0||t!=0&&t!=1){var p=Numerical.TOLERANCE;t<p&&s==r&&o==i?t=p:t>1-p&&u==f&&a==l&&(t=1-p);var d=3*(s-r),v=3*(u-s)-d,m=f-r-d-v,g=3*(o-i),y=3*(a-o)-g,b=l-i-g-y;switch(n){case 0:c=((m*t+v)*t+d)*t+r,h=((b*t+y)*t+g)*t+i;break;case 1:case 2:c=(3*m*t+2*v)*t+d,h=(3*b*t+2*y)*t+g}}else c=t==0?r:f,h=t==0?i:l;return n==2?new Point(h,-c):new Point(c,h)},subdivide:function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7];t===undefined&&(t=.5);var l=1-t,c=l*n+t*i,h=l*r+t*s,p=l*i+t*o,d=l*s+t*u,v=l*o+t*a,m=l*u+t*f,g=l*c+t*p,y=l*h+t*d,b=l*p+t*v,w=l*d+t*m,E=l*g+t*b,S=l*y+t*w;return[[n,r,c,h,g,y,E,S],[E,S,b,w,v,m,a,f]]},solveCubic:function(e,t,n,r){var i=e[t],s=e[t+2],o=e[t+4],u=e[t+6],a=3*(s-i),f=3*(o-s)-a,l=u-i-a-f;return Numerical.solveCubic(l,f,a,i-n,r,Numerical.TOLERANCE)},getParameter:function(e,t,n){var r=[],i=[],s=Curve.solveCubic(e,0,t,r),o=Curve.solveCubic(e,1,n,i),u,a;for(var f=0;s==-1||f<s;)if(s==-1||(u=r[f++])>=0&&u<=1){for(var l=0;o==-1||l<o;)if(o==-1||(a=i[l++])>=0&&a<=1){s==-1?u=a:o==-1&&(a=u);if(Math.abs(u-a)<Numerical.TOLERANCE)return(u+a)*.5}if(s==-1)break}return null},getPart:function(e,t,n){return t>0&&(e=Curve.subdivide(e,t)[1]),n<1&&(e=Curve.subdivide(e,(n-t)/(1-t))[0]),e},isFlatEnough:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=3*r-2*t-u,l=3*i-2*n-a,c=3*s-2*u-t,h=3*o-2*a-n;return Math.max(f*f,c*c)+Math.max(l*l,h*h)<1}}},new function(){function e(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=9*(r-s)+3*(u-t),l=6*(t+s)-12*r,c=3*(r-t),h=9*(i-o)+3*(a-n),p=6*(n+o)-12*i,d=3*(i-n);return function(e){var t=(f*e+l)*e+c,n=(h*e+p)*e+d;return Math.sqrt(t*t+n*n)}}function t(e,t){return Math.max(2,Math.min(16,Math.ceil(Math.abs(t-e)*32)))}return{statics:!0,getLength:function(n,r,i){r===undefined&&(r=0),i===undefined&&(i=1);if(n[0]==n[2]&&n[1]==n[3]&&n[6]==n[4]&&n[7]==n[5]){var s=n[6]-n[0],o=n[7]-n[1];return(i-r)*Math.sqrt(s*s+o*o)}var u=e(n);return Numerical.integrate(u,r,i,t(r,i))},getParameterAt:function(n,r,i){function h(e){var n=t(i,e);return c+=i<e?Numerical.integrate(a,i,e,n):-Numerical.integrate(a,e,i,n),i=e,c-r}if(r==0)return i;var s=r>0,o=s?i:0,u=s?1:i,r=Math.abs(r),a=e(n),f=Numerical.integrate(a,o,u,t(o,u));if(r>=f)return s?u:o;var l=r/f,c=0;return Numerical.findRoot(h,a,s?o+l:u-l,o,u,16,Numerical.TOLERANCE)}}},new function(){function i(e,t){var r=3,i=5,s=[],o=[],u=[],a=[];for(var f=0;f<=r;f++)s[f]=e[f].subtract(t),f<r&&(o[f]=e[f+1].subtract(e[f]).multiply(r));for(var l=0;l<r;l++){u[l]=[];for(var c=0;c<=r;c++)u[l][c]=o[l].dot(s[c])}for(var f=0;f<=i;f++)a[f]=new Point(f/i,0);for(k=0;k<=i;k++){var h=Math.max(0,k-r+1),p=Math.min(k,r);for(var f=h;f<=p;f++){var d=k-f;a[k].y+=u[d][f]*n[d][f]}}return a}function s(t,n){switch(o(t)){case 0:return[];case 1:if(n>=e)return[.5*(t[0].x+t[5].x)];if(u(t)){var i=new Line(t[0],t[5],!0);return[i.vector.getLength(!0)<=Numerical.EPSILON?i.point.x:r.intersect(i).x]}}var a=[[]],f=[],l=[];for(var c=0;c<=5;c++)a[0][c]=new Point(t[c]);for(var h=1;h<=5;h++){a[h]=[];for(var c=0;c<=5-h;c++)a[h][c]=a[h-1][c].add(a[h-1][c+1]).multiply(.5)}for(var c=0;c<=5;c++)f[c]=a[c][0],l[c]=a[5-c][c];return s(f,n+1).concat(s(l,n+1))}function o(e){var t=0,n=null;for(var r=0,i=e.length;r<i;r++){var s=e[r].y<0?-1:1;n!=null&&s!=n&&t++,n=s}return t}function u(e){var n=e.length-1,r=e[0].y-e[n].y,i=e[n].x-e[0].x,s=e[0].x*e[n].y-e[n].x*e[0].y,o=0,u=0;for(var a=1;a<n;a++){var f=r*e[a].x+i*e[a].y+s,l=f*f;f<0&&l>u?u=l:l>o&&(o=l)}return Math.abs((o+u)/(2*r*(r*r+i*i)))<t}var e=32,t=Math.pow(2,-e-1),n=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],r=new Line(new Point(0,0),new Point(1,0));return{getNearestLocation:function(e){var t=i(this.getPoints(),e),n=s(t,0).concat([0,1]),r=Infinity,o,u;for(var a=0;a<n.length;a++){var f=this.getPoint(n[a]),l=e.getDistance(f,!0);l<r&&(r=l,o=n[a],u=f)}return new CurveLocation(this,o,u,Math.sqrt(r))},getNearestPoint:function(e){return this.getNearestLocation(e).getPoint()}}});CurveLocation=Base.extend({initialize:function(e,t,n,r){this._curve=e,this._parameter=t,this._point=n,this._distance=r},getSegment:function(){if(!this._segment){var e=this._curve,t=this.getParameter();if(t==0)this._segment=e._segment1;else if(t==1)this._segment=e._segment2;else{if(t==null)return null;this._segment=e.getLength(0,t)<e.getLength(t,1)?e._segment1:e._segment2}}return this._segment},getCurve:function(){return this._curve},getPath:function(){return this._curve&&this._curve._path},getIndex:function(){return this._curve&&this._curve.getIndex()},getOffset:function(){var e=this._curve&&this._curve._path;return e&&e._getOffset(this)},getCurveOffset:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getLength(0,e)},getParameter:function(){return this._parameter==null&&this._curve&&this._point&&(this._parameter=this._curve.getParameterAt(this._point)),this._parameter},getPoint:function(){return!this._point&&this._curve&&this._parameter!=null&&(this._point=this._curve.getPoint(this._parameter)),this._point},getTangent:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getTangent(e)},getNormal:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getNormal(e)},getDistance:function(){return this._distance},toString:function(){var e=[],t=this.getPoint();t&&e.push("point: "+t);var n=this.getIndex();n!=null&&e.push("index: "+n);var r=this.getParameter();return r!=null&&e.push("parameter: "+Base.formatNumber(r)),this._distance!=null&&e.push("distance: "+Base.formatNumber(this._distance)),"{ "+e.join(", ")+" }"}});var PathItem=this.PathItem=Item.extend({}),Path=this.Path=PathItem.extend({initialize:function(e){this.base(),this._closed=!1,this._selectedSegmentState=0,this.setSegments(!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e)},clone:function(){var e=this._clone(new Path(this._segments));return e._closed=this._closed,this._clockwise!==undefined&&(e._clockwise=this._clockwise),e},_changed:function(e){Item.prototype._changed.call(this,e);if(e&ChangeFlag.GEOMETRY){delete this._length,delete this._clockwise;if(this._curves!=null)for(var t=0,n=this._curves.length;t<n;t++)this._curves[t]._changed(Change.GEOMETRY)}else e&ChangeFlag.STROKE&&delete this._bounds},getSegments:function(){return this._segments},setSegments:function(e){this._segments?(this._selectedSegmentState=0,this._segments.length=0,this._curves&&delete this._curves):this._segments=[],this._add(Segment.readAll(e))},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){if(!this._curves){var e=this._segments,t=e.length;!this._closed&&t>0&&t--,this._curves=new Array(t);for(var n=0;n<t;n++)this._curves[n]=Curve.create(this,e[n],e[n+1]||e[0])}return this._curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},getClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){this._closed=e;if(this._curves){var t=this._segments.length,n;!e&&t>0&&t--,this._curves.length=t,e&&(this._curves[n=t-1]=Curve.create(this,this._segments[n],this._segments[0]))}this._changed(Change.GEOMETRY)}},transform:function(e){return this.base(e,!0)},getMatrix:function(){return null},setMatrix:function(e){},_apply:function(e){var t=new Array(6);for(var n=0,r=this._segments.length;n<r;n++)this._segments[n]._transformCoordinates(e,t,!0);var i=this._style,s=i._fillColor,o=i._strokeColor;return s&&s.transform&&s.transform(e),o&&o.transform&&o.transform(e),!0},_add:function(e,t){var n=this._segments,r=this._curves,i=e.length,s=t==null,t=s?n.length:t,o=this.isFullySelected();for(var u=0;u<i;u++){var a=e[u];a._path&&(a=e[u]=new Segment(a)),a._path=this,a._index=t+u,o&&(a._selectionState=SelectionState.POINT),a._selectionState&&this._updateSelection(a,0,a._selectionState)}if(s)n.push.apply(n,e);else{n.splice.apply(n,[t,0].concat(e));for(var u=t+i,f=n.length;u<f;u++)n[u]._index=u}if(r&&--t>=0){r.splice(t,0,Curve.create(this,n[t],n[t+1]));var l=r[t+i];l&&(l._segment1=n[t+i])}return this._changed(Change.GEOMETRY),e},add:function(e){return arguments.length>1&&typeof e!="number"?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(e,t){return arguments.length>2&&typeof t!="number"?this._add(Segment.readAll(arguments,1),e):this._add([Segment.read(arguments,1)],e)[0]},addSegment:function(e){return this._add([Segment.read(arguments)])[0]},insertSegment:function(e,t){return this._add([Segment.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(Segment.readAll(e))},insertSegments:function(e,t){return this._add(Segment.readAll(t),e)},removeSegment:function(e){var t=this.removeSegments(e,e+1);return t[0]||null},removeSegments:function(e,t){e=e||0,t=Base.pick(t,this._segments.length);var n=this._segments,r=this._curves,i=t>=n.length,s=n.splice(e,t-e),o=s.length;if(!o)return s;for(var u=0;u<o;u++){var a=s[u];a._selectionState&&this._updateSelection(a,a._selectionState,0),s._index=s._path=undefined}for(var u=e,f=n.length;u<f;u++)n[u]._index=u;if(r){r.splice(e,o);var l;if(l=r[e-1])l._segment2=n[e];if(l=r[e])l._segment1=n[e];i&&this._closed&&(l=r[r.length-1])&&(l._segment2=n[0])}return this._changed(Change.GEOMETRY),s},isFullySelected:function(){return this._selected&&this._selectedSegmentState==this._segments.length*SelectionState.POINT},setFullySelected:function(e){var t=this._segments.length;this._selectedSegmentState=e?t*SelectionState.POINT:0;for(var n=0;n<t;n++)this._segments[n]._selectionState=e?SelectionState.POINT:0;this.setSelected(e)},_updateSelection:function(e,t,n){e._selectionState=n;var r=this._selectedSegmentState+=n-t;r>0&&this.setSelected(!0)},flatten:function(e){var t=new PathFlattener(this),n=0,r=t.length/Math.ceil(t.length/e),i=t.length+(this._closed?-r:r)/2,s=[];while(n<=i)s.push(new Segment(t.evaluate(n,0))),n+=r;this.setSegments(s)},simplify:function(e){if(this._segments.length>2){var t=new PathFitter(this,e||2.5);this.setSegments(t.fit())}},isClockwise:function(){function r(r,i){t!==undefined&&(e+=(t-r)*(i+n)),t=r,n=i}if(this._clockwise!==undefined)return this._clockwise;var e=0,t,n;for(var i=0,s=this._segments.length;i<s;i++){var o=this._segments[i],u=this._segments[i+1<s?i+1:0],a=o._point,f=o._handleOut,l=u._handleIn,c=u._point;r(a._x,a._y),r(a._x+f._x,a._y+f._y),r(c._x+l._x,c._y+l._y),r(c._x,c._y)}return e>0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&(this.reverse(),this._clockwise=e)},reverse:function(){this._segments.reverse();for(var e=0,t=this._segments.length;e<t;e++){var n=this._segments[e],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r,n._index=e}this._clockwise!==undefined&&(this._clockwise=!this._clockwise)},join:function(e){if(e){var t=e._segments,n=this.getLastSegment(),r=e.getLastSegment();n._point.equals(r._point)&&e.reverse();var i=e.getFirstSegment();if(n._point.equals(i._point))n.setHandleOut(i._handleOut),this._add(t.slice(1));else{var s=this.getFirstSegment();s._point.equals(i._point)&&e.reverse(),r=e.getLastSegment(),s._point.equals(r._point)?(s.setHandleIn(r._handleIn),this._add(t.slice(0,t.length-1),0)):this._add(t.slice(0))}e.remove();var s=this.getFirstSegment();return n=this.getLastSegment(),n._point.equals(s._point)&&(s.setHandleIn(n._handleIn),n.remove(),this.setClosed(!0)),this._changed(Change.GEOMETRY),!0}return!1},getLength:function(){if(this._length==null){var e=this.getCurves();this._length=0;for(var t=0,n=e.length;t<n;t++)this._length+=e[t].getLength()}return this._length},_getOffset:function(e){var t=e&&e.getIndex();if(t!=null){var n=this.getCurves(),r=0;for(var i=0;i<t;i++)r+=n[i].getLength();var s=n[t];return r+s.getLength(0,e.getParameter())}return null},getLocation:function(e){var t=this.getCurves();for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.getParameter(e);if(s!=null)return new CurveLocation(i,s)}return null},getLocationAt:function(e,t){var n=this.getCurves(),r=0;if(t){var i=~~e;return new CurveLocation(n[i],e-i)}for(var s=0,o=n.length;s<o;s++){var u=r,a=n[s];r+=a.getLength();if(r>=e)return new CurveLocation(a,a.getParameterAt(e-u))}return e<=this.getLength()?new CurveLocation(n[n.length-1],1):null},getPointAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getPoint()},getTangentAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getTangent()},getNormalAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getNormal()},getNearestLocation:function(e){var t=this.getCurves(),n=Infinity,r=null;for(var i=0,s=t.length;i<s;i++){var o=t[i].getNearestLocation(e);o._distance<n&&(n=o._distance,r=o)}return r},getNearestPoint:function(e){return this.getNearestLocation(e).getPoint()},contains:function(e){e=Point.read(arguments);if(!this._closed||!this.getRoughBounds()._containsPoint(e))return!1;var t=this.getCurves(),n=0,r=[];for(var i=0,s=t.length;i<s;i++)n+=t[i].getCrossings(e,r);return(n&1)==1},_hitTest:function(e,t){function f(t,n,i){if(e.getDistance(n)<r)return new HitResult(i,a,{segment:t,point:n})}function l(e,n){var r=e._point;return(n||t.segments)&&f(e,r,"segment")||!n&&t.handles&&(f(e,r.add(e._handleIn),"handle-in")||f(e,r.add(e._handleOut),"handle-out"))}var n=this._style,r=t.tolerance||0,i=(t.stroke&&n._strokeColor?n._strokeWidth/2:0)+r,s,o,u=[],a=this;if(t.ends&&!t.segments&&!this._closed){if(o=l(this.getFirstSegment(),!0)||l(this.getLastSegment(),!0))return o}else if(t.segments||t.handles)for(var c=0,h=this._segments.length;c<h;c++)if(o=l(this._segments[c]))return o;t.stroke&&i>0&&(s=this.getNearestLocation(e));if(!(s&&s._distance<=i)&&t.fill&&n._fillColor&&this.contains(e))return new HitResult("fill",this);!s&&t.stroke&&i>0&&(s=this.getNearestLocation(e));if(s&&s._distance<=i)return t.stroke?new HitResult("stroke",this,{location:s}):new HitResult("fill",this)}},new function(){function e(e,t,n){var r=new Array(6);for(var i=0,s=t.length;i<s;i++){var o=t[i];o._transformCoordinates(n,r,!1);var u=o._selectionState,a=u&SelectionState.POINT,f=r[0],l=r[1];function c(t){var n=r[t],i=r[t+1];if(f!=n||l!=i)e.beginPath(),e.moveTo(f,l),e.lineTo(n,i),e.stroke(),e.beginPath(),e.arc(n,i,1.75,0,Math.PI*2,!0),e.fill()}(a||u&SelectionState.HANDLE_IN)&&c(2),(a||u&SelectionState.HANDLE_OUT)&&c(4),e.save(),e.beginPath(),e.rect(f-2,l-2,4,4),e.fill(),a||(e.beginPath(),e.rect(f-1,l-1,2,2),e.fillStyle="#ffffff",e.fill()),e.restore()}}function t(e,t,n){function p(t){var i=r[t];if(n)i._transformCoordinates(n,s,!1),u=s[0],a=s[1];else{var p=i._point;u=p._x,a=p._y}if(o)e.moveTo(u,a),o=!1;else{if(n)f=s[2],l=s[3];else{var d=i._handleIn;f=u+d._x,l=a+d._y}f==u&&l==a&&c==u&&h==a?e.lineTo(u,a):e.bezierCurveTo(c,h,f,l,u,a)}if(n)c=s[4],h=s[5];else{var d=i._handleOut;c=u+d._x,h=a+d._y}}var r=t._segments,i=r.length,s=new Array(6),o=!0,u,a,f,l,c,h;for(var d=0;d<i;d++)p(d);t._closed&&i>1&&p(0)}return{draw:function(e,n){n.compound||e.beginPath();var r=this._style,i=r._fillColor,s=r._strokeColor,o=r._dashArray,u=s&&o&&o.length;(n.compound||this._clipMask||i||s&&!u)&&t(e,this),this._closed&&e.closePath();if(this._clipMask)e.clip();else if(!n.compound&&(i||s)){e.save(),this._setStyles(e),i&&e.fill();if(s){if(u){e.beginPath();var a=new PathFlattener(this),f=r._dashOffset,l,c=0;while(f<a.length)l=f+o[c++%o.length],a.drawPart(e,f,l),f=l+o[c++%o.length]}e.stroke()}e.restore()}},drawSelected:function(n,r){n.beginPath(),t(n,this,r),n.stroke(),e(n,this._segments,r)}}},new function(){function e(e){var t=e.length,n=[],r=[],i=2;n[0]=e[0]/i;for(var s=1;s<t;s++)r[s]=1/i,i=(s<t-1?4:2)-r[s],n[s]=(e[s]-n[s-1])/i;for(var s=1;s<t;s++)n[t-s-1]-=r[t-s]*n[t-s];return n}return{smooth:function(){var t=this._segments,n=t.length,r=n,i;if(n<=2)return;this._closed?(i=Math.min(n,4),r+=Math.min(n,i)*2):i=0;var s=[];for(var o=0;o<n;o++)s[o+i]=t[o]._point;if(this._closed)for(var o=0;o<i;o++)s[o]=t[o+n-i]._point,s[o+n+i]=t[o]._point;else r--;var u=[];for(var o=1;o<r-1;o++)u[o]=4*s[o]._x+2*s[o+1]._x;u[0]=s[0]._x+2*s[1]._x,u[r-1]=3*s[r-1]._x;var a=e(u);for(var o=1;o<r-1;o++)u[o]=4*s[o]._y+2*s[o+1]._y;u[0]=s[0]._y+2*s[1]._y,u[r-1]=3*s[r-1]._y;var f=e(u);if(this._closed){for(var o=0,l=n;o<i;o++,l++){var c=o/i,h=1-c;a[l]=a[o]*c+a[l]*h,f[l]=f[o]*c+f[l]*h;var p=o+i,d=l+i;a[d]=a[p]*h+a[d]*c,f[d]=f[p]*h+f[d]*c}r--}var v=null;for(var o=i;o<=r-i;o++){var m=t[o-i];v&&m.setHandleIn(v.subtract(m._point)),o<r&&(m.setHandleOut(Point.create(a[o],f[o]).subtract(m._point)),o<r-1?v=Point.create(2*s[o+1]._x-a[o+1],2*s[o+1]._y-f[o+1]):v=Point.create((s[r]._x+a[r-1])/2,(s[r]._y+f[r-1])/2))}if(this._closed&&v){var m=this._segments[0];m.setHandleIn(v.subtract(m._point))}}}},new function(){function e(e){var t=e._segments;if(t.length==0)throw new Error("Use a moveTo() command first");return t[t.length-1]}return{moveTo:function(e){this._segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(e){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(e){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(t,n,r){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1),r=Point.read(arguments,2,1);var i=e(this);i.setHandleOut(t.subtract(i._point)),this._add([new Segment(r,n.subtract(r))])},quadraticCurveTo:function(t,n){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1);var r=e(this)._point;this.cubicCurveTo(t.add(r.subtract(t).multiply(1/3)),t.add(n.subtract(t).multiply(1/3)),n)},curveTo:function(t,n,r){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1);var i=Base.pick(r,.5),s=1-i,o=e(this)._point,u=t.subtract(o.multiply(s*s)).subtract(n.multiply(i*i)).divide(2*i*s);if(u.isNaN())throw new Error("Cannot put a curve through points with parameter = "+i);this.quadraticCurveTo(u,n)},arcTo:function(t,n){var r=e(this),i=r._point,s;n===undefined&&(n=!0);if(typeof n=="boolean"){t=Point.read(arguments,0,1);var o=i.add(t).divide(2),s=o.add(o.subtract(i).rotate(n?-90:90))}else s=Point.read(arguments,0,1),t=Point.read(arguments,1,1);var u=new Line(i.add(s).divide(2),s.subtract(i).rotate(90)),a=new Line(s.add(t).divide(2),t.subtract(s).rotate(90)),f=u.intersect(a),l=new Line(i,t,!0),c=l.getSide(s);if(!f){if(!c)return this.lineTo(t);throw new Error("Cannot put an arc through the given points: "+[i,s,t])}var h=i.subtract(f),p=h.getLength(),d=h.getDirectedAngle(t.subtract(f)),v=l.getSide(f);v==0?d=c*Math.abs(d):c==v&&(d-=360*(d<0?-1:1));var m=Math.abs(d),g=m>=360?4:Math.ceil(m/90),y=d/g,b=y*Math.PI/360,w=4/3*Math.sin(b)/(1+Math.cos(b)),E=[];for(var S=0;S<=g;S++){var x=S<g?f.add(h):t,T=S<g?h.rotate(90).multiply(w):null;S==0?r.setHandleOut(T):E.push(new Segment(x,h.rotate(-90).multiply(w),T)),h=h.rotate(y)}this._add(E)},lineBy:function(t){t=Point.read(arguments);var n=e(this);this.lineTo(n._point.add(t))},curveBy:function(t,n,r){t=Point.read(t),n=Point.read(n);var i=e(this)._point;this.curveTo(i.add(t),i.add(n),r)},arcBy:function(t,n){t=Point.read(t),n=Point.read(n);var r=e(this)._point;this.arcBy(r.add(t),r.add(n))},closePath:function(){this.setClosed(!0)}}},new function(){function e(e,t){function l(n){n._transformCoordinates(e,i,!1);for(var r=0;r<2;r++){var l=s[r],c=s[r+4],h=i[r+2],p=i[r];function d(e,n){var i=0;if(e==null){var s=1-n;e=s*s*s*l+3*s*s*n*c+3*s*n*n*h+n*n*n*p,i=t?t[r]:0}var a=e-i,f=e+i;a<o[r]&&(o[r]=a),f>u[r]&&(u[r]=f)}d(p,null);var v=3*(c-h)-l+p,m=2*(l+h)-4*c,g=c-l;if(v==0){if(m==0)continue;var y=-g/m;a<y&&y<f&&d(null,y);continue}var b=m*m-4*v*g;if(b<0)continue;var w=Math.sqrt(b),E=-0.5/v,S=(m-w)*E,x=(m+w)*E;a<S&&S<f&&d(null,S),a<x&&x<f&&d(null,x)}var T=s;s=i,i=T}var n=this._segments,r=n[0];if(!r)return null;var i=new Array(6),s=new Array(6);r._transformCoordinates(e,s,!1);var o=s.slice(0,2),u=o.slice(0),a=Numerical.TOLERANCE,f=1-a;for(var c=1,h=n.length;c<h;c++)l(n[c]);return this._closed&&l(r),Rectangle.create(o[0],o[1],u[0]-o[0],u[1]-o[1])}function t(e,t){if(!t)return[e,e];var n=t.createShiftless(),r=n.transform(Point.create(e,0)),i=n.transform(Point.create(0,e)),s=r.getAngleInRadians(),o=r.getLength(),u=i.getLength(),a=Math.sin(s),f=Math.cos(s),l=Math.tan(s),c=-Math.atan(u*l/o),h=Math.atan(u/(l*o));return[Math.abs(o*Math.cos(c)*f-u*Math.sin(c)*a),Math.abs(u*Math.sin(h)*f+o*Math.cos(h)*a)]}function n(n){function d(e){h=h.include(n?n._transformPoint(e,e):e)}function v(e,t){var n=e.getPoint(t),r=e.getNormal(t).normalize(s);d(n.add(r)),d(n.subtract(r))}function m(e,t){if(t==="round"||!e._handleIn.isZero()&&!e._handleOut.isZero())h=h.unite(p.setCenter(n?n._transformPoint(e._point):e._point));else if(t=="bevel"){var r=e.getCurve();v(r,0),v(r.getPrevious(),1)}else if(t=="miter"){var i=e.getCurve(),o=i.getPrevious(),u=i.getPoint(0),a=o.getNormal(1).normalize(s),l=i.getNormal(0).normalize(s),c=new Line(u.subtract(a),Point.create(-a.y,a.x)),g=new Line(u.subtract(l),Point.create(-l.y,l.x)),y=c.intersect(g);!y||u.getDistance(y)>f?m(e,"bevel"):d(y)}}function g(e,t,n){switch(t){case"round":return m(e,t);case"butt":case"square":var r=e.getCurve(),i=r.getPoint(n),o=r.getNormal(n).normalize(s);t==="square"&&(i=i.add(o.rotate(n==0?-90:90))),d(i.add(o)),d(i.subtract(o))}}var r=this._style;if(!r._strokeColor||!r._strokeWidth)return e.call(this,n);var i=r._strokeWidth,s=i/2,o=t(s,n),u=r._strokeJoin,a=r._strokeCap,f=r._miterLimit*i/2,l=this._segments,c=l.length,h=e.call(this,n,o),p=new Rectangle((new Size(o)).multiply(2));for(var y=1,b=c-(this._closed?0:1);y<b;y++)m(l[y],u);return this._closed?m(l[0],u):(g(l[0],a,0),g(l[c-1],a,1)),h}function r(e,t,n){var r=new Array(6),i=Infinity,s=-i,o=i,u=s;t=t/2||0,n=n/2||0;for(var a=0,f=this._segments.length;a<f;a++){var l=this._segments[a];l._transformCoordinates(e,r,!1);for(var c=0;c<6;c+=2){var h=c==0?n:t,p=r[c],d=r[c+1],v=p-h,m=p+h,g=d-h,y=d+h;v<i&&(i=v),m>s&&(s=m),g<o&&(o=g),y>u&&(u=y)}}return Rectangle.create(i,o,s-i,u-o)}function i(e){var t=this._style,n=t._strokeWidth;return r.call(this,e,n,t._strokeJoin=="miter"?n*t._miterLimit:n)}var s={bounds:e,strokeBounds:n,handleBounds:r,roughBounds:i};return{_getBounds:function(e,t){return s[e].call(this,t)}}});Path.inject({statics:new function(){var e=2/3*(Math.sqrt(2)-1),t=[new Segment([0,.5],[0,e],[0,-e]),new Segment([.5,0],[-e,0],[e,0]),new Segment([1,.5],[0,-e],[0,e]),new Segment([.5,1],[e,0],[-e,0])];return{Line:function(){var e=Math.floor(arguments.length/2);return new Path(Segment.read(arguments,0,e),Segment.read(arguments,e,e))},Rectangle:function(e){e=Rectangle.read(arguments);var t=e.x,n=e.y,r=t+e.width,i=n+e.height,s=new Path;return s._add([new Segment(Point.create(t,i)),new Segment(Point.create(t,n)),new Segment(Point.create(r,n)),new Segment(Point.create(r,i))]),s._closed=!0,s},RoundRectangle:function(t,n){arguments.length==2?(t=Rectangle.read(arguments,0,1),n=Size.read(arguments,1,1)):arguments.length==6&&(t=Rectangle.read(arguments,0,4),n=Size.read(arguments,4,2)),n=Size.min(n,t.getSize(!0).divide(2));var r=new Path,i=n.multiply(e*2),s=t.getBottomLeft(!0),o=t.getTopLeft(!0),u=t.getTopRight(!0),a=t.getBottomRight(!0);return r._add([new Segment(s.add(n.width,0),null,[-i.width,0]),new Segment(s.subtract(0,n.height),[0,i.height],null),new Segment(o.add(0,n.height),null,[0,-i.height]),new Segment(o.add(n.width,0),[-i.width,0],null),new Segment(u.subtract(n.width,0),null,[i.width,0]),new Segment(u.add(0,n.height),[0,-i.height],null),new Segment(a.subtract(0,n.height),null,[0,i.height]),new Segment(a.subtract(n.width,0),[i.width,0],null)]),r._closed=!0,r},Oval:function(e){e=Rectangle.read(arguments);var n=new Path,r=e.getPoint(!0),i=e.getSize(!0),s=new Array(4);for(var o=0;o<4;o++){var u=t[o];s[o]=new Segment(u._point.multiply(i).add(r),u._handleIn.multiply(i),u._handleOut.multiply(i))}return n._add(s),n._closed=!0,n},Circle:function(e,t){return arguments.length==3?(e=Point.read(arguments,0,2),t=arguments[2]):e=Point.read(arguments,0,1),Path.Oval(new Rectangle(e.subtract(t),Size.create(t*2,t*2)))},Arc:function(e,t,n){var r=new Path;return r.moveTo(e),r.arcTo(t,n),r},RegularPolygon:function(e,t,n){e=Point.read(arguments,0,1);var r=new Path,i=360/t,s=!(t%3),o=new Point(0,s?-n:n),u=s?-1:.5,a=new Array(t);for(var f=0;f<t;f++)a[f]=new Segment(e.add(o.rotate((f+u)*i)));return r._add(a),r._closed=!0,r},Star:function(e,t,n,r){e=Point.read(arguments,0,1),t*=2;var i=new Path,s=360/t,o=new Point(0,-1),u=new Array(t);for(var a=0;a<t;a++)u[a]=new Segment(e.add(o.rotate(s*a).multiply(a%2?r:n)));return i._add(u),i._closed=!0,i}}}});var CompoundPath=this.CompoundPath=PathItem.extend({initialize:function(e){this.base(),this._children=[],this._namedChildren={};var t=!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e;this.addChildren(t)},insertChild:function(e,t){this.base(e,t),t._clockwise===undefined&&t.setClockwise(t._index==0)},simplify:function(){if(this._children.length==1){var e=this._children[0];return e.insertAbove(this),this.remove(),e}return this},smooth:function(){for(var e=0,t=this._children.length;e<t;e++)this._children[e].smooth()},draw:function(e,t){var n=this._children;if(n.length==0)return;var r=n[0],i=r._style;e.beginPath(),t.compound=!0;for(var s=0,o=n.length;s<o;s++)Item.draw(n[s],e,t);r._setStyles(e),i._fillColor&&e.fill(),i._strokeColor&&e.stroke(),t.compound=!1}},new function(){function e(e){if(!e._children.length)throw new Error("Use a moveTo() command first");return e._children[e._children.length-1]}var t={moveTo:function(e){var t=new Path;this.addChild(t),t.moveTo.apply(t,arguments)},moveBy:function(t){this.moveTo(e(this).getLastSegment()._point.add(Point.read(arguments)))},closePath:function(){e(this).setClosed(!0)}};return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","curveBy","arcBy"],function(n){t[n]=function(){var t=e(this);t[n].apply(t,arguments)}}),t}),PathFlattener=Base.extend({initialize:function(e){function s(e,t){var n=Curve.getValues(e,t);i.curves.push(n),i._computeParts(n,e._index,0,1)}this.curves=[],this.parts=[],this.length=0,this.index=0;var t=e._segments,n=t[0],r,i=this;for(var o=1,u=t.length;o<u;o++)r=t[o],s(n,r),n=r;e._closed&&s(r,t[0])},_computeParts:function(e,t,n,r){if(r-n>1/32&&!Curve.isFlatEnough(e)){var i=Curve.subdivide(e),s=(n+r)/2;this._computeParts(i[0],t,n,s),this._computeParts(i[1],t,s,r)}else{var o=e[6]-e[0],u=e[7]-e[1],a=Math.sqrt(o*o+u*u);a>Numerical.TOLERANCE&&(this.length+=a,this.parts.push({offset:this.length,value:r,index:t}))}},getParameterAt:function(e){var t,n=this.index;for(;;){t=n;if(n==0||this.parts[--n].offset<e)break}for(var r=this.parts.length;t<r;t++){var i=this.parts[t];if(i.offset>=e){this.index=t;var s=this.parts[t-1],o=s&&s.index==i.index?s.value:0,u=s?s.offset:0;return{value:o+(i.value-o)*(e-u)/(i.offset-u),index:i.index}}}var i=this.parts[this.parts.length-1];return{value:1,index:i.index}},evaluate:function(e,t){var n=this.getParameterAt(e);return Curve.evaluate(this.curves[n.index],n.value,t)},drawPart:function(e,t,n){t=this.getParameterAt(t),n=this.getParameterAt(n);for(var r=t.index;r<=n.index;r++){var i=Curve.getPart(this.curves[r],r==t.index?t.value:0,r==n.index?n.value:1);r==t.index&&e.moveTo(i[0],i[1]),e.bezierCurveTo.apply(e,i.slice(2))}}}),PathFitter=Base.extend({initialize:function(e,t){this.points=[];var n=e._segments,r;for(var i=0,s=n.length;i<s;i++){var o=n[i].point.clone();if(!r||!r.equals(o))this.points.push(o),r=o}this.error=t},fit:function(){return this.segments=[new Segment(this.points[0])],this.fitCubic(0,this.points.length-1,this.points[1].subtract(this.points[0]).normalize(),this.points[this.points.length-2].subtract(this.points[this.points.length-1]).normalize()),this.segments},fitCubic:function(e,t,n,r){if(t-e==1){var i=this.points[e],s=this.points[t],o=i.getDistance(s)/3;this.addCurve([i,i.add(n.normalize(o)),s.add(r.normalize(o)),s]);return}var u=this.chordLengthParameterize(e,t),a=Math.max(this.error,this.error*this.error),f,l;for(var c=0;c<=4;c++){var h=this.generateBezier(e,t,u,n,r),p=this.findMaxError(e,t,h,u);if(p.error<this.error){this.addCurve(h);return}l=p.index;if(p.error>=a)break;this.reparameterize(e,t,u,h),a=p.error}var d=this.points[l-1].subtract(this.points[l]),v=this.points[l].subtract(this.points[l+1]),m=d.add(v).divide(2).normalize();this.fitCubic(e,l,n,m),this.fitCubic(l,t,m.negate(),r)},addCurve:function(e){var t=this.segments[this.segments.length-1];t.setHandleOut(e[1].subtract(e[0])),this.segments.push(new Segment(e[3],e[2].subtract(e[3])))},generateBezier:function(e,t,n,r,i){var s=Numerical.EPSILON,o=this.points[e],u=this.points[t],a=[[0,0],[0,0]],f=[0,0];for(var l=0,c=t-e+1;l<c;l++){var h=n[l],p=1-h,d=3*h*p,v=p*p*p,m=d*p,g=d*h,y=h*h*h,b=r.normalize(m),w=i.normalize(g),E=this.points[e+l].subtract(o.multiply(v+m)).subtract(u.multiply(g+y));a[0][0]+=b.dot(b),a[0][1]+=b.dot(w),a[1][0]=a[0][1],a[1][1]+=w.dot(w),f[0]+=b.dot(E),f[1]+=w.dot(E)}var S=a[0][0]*a[1][1]-a[1][0]*a[0][1],x,T;if(Math.abs(S)>s){var N=a[0][0]*f[1]-a[1][0]*f[0],C=f[0]*a[1][1]-f[1]*a[0][1];x=C/S,T=N/S}else{var k=a[0][0]+a[0][1],L=a[1][0]+a[1][1];Math.abs(k)>s?x=T=f[0]/k:Math.abs(L)>s?x=T=f[1]/L:x=T=0}var A=u.getDistance(o);s*=A;if(x<s||T<s)x=T=A/3;return[o,o.add(r.normalize(x)),u.add(i.normalize(T)),u]},reparameterize:function(e,t,n,r){for(var i=e;i<=t;i++)n[i-e]=this.findRoot(r,this.points[i],n[i-e])},findRoot:function(e,t,n){var r=[],i=[];for(var s=0;s<=2;s++)r[s]=e[s+1].subtract(e[s]).multiply(3);for(var s=0;s<=1;s++)i[s]=r[s+1].subtract(r[s]).multiply(2);var o=this.evaluate(3,e,n),u=this.evaluate(2,r,n),a=this.evaluate(1,i,n),f=o.subtract(t),l=u.dot(u)+f.dot(a);return Math.abs(l)<Numerical.TOLERANCE?n:n-f.dot(u)/l},evaluate:function(e,t,n){var r=t.slice();for(var i=1;i<=e;i++)for(var s=0;s<=e-i;s++)r[s]=r[s].multiply(1-n).add(r[s+1].multiply(n));return r[0]},chordLengthParameterize:function(e,t){var n=[0];for(var r=e+1;r<=t;r++)n[r-e]=n[r-e-1]+this.points[r].getDistance(this.points[r-1]);for(var r=1,i=t-e;r<=i;r++)n[r]/=n[i];return n},findMaxError:function(e,t,n,r){var i=Math.floor((t-e+1)/2),s=0;for(var o=e+1;o<t;o++){var u=this.evaluate(3,n,r[o-e]),a=u.subtract(this.points[o]),f=a.x*a.x+a.y*a.y;f>=s&&(s=f,i=o)}return{error:s,index:i}}}),TextItem=this.TextItem=Item.extend({_boundsType:"bounds",initialize:function(e){this._style=CharacterStyle.create(this),this._paragraphStyle=ParagraphStyle.create(this),this.base(e),this.setParagraphStyle(),this._content="",this._lines=[]},_clone:function(e){return e.setContent(this._content),e.setParagraphStyle(this._paragraphStyle),this.base(e)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(Change.CONTENT)},getCharacterStyle:function(){return this.getStyle()},setCharacterStyle:function(e){this.setStyle(e)}}),PointText=this.PointText=TextItem.extend({initialize:function(e){this.base(e),this._point=this._matrix.getTranslation()},clone:function(){return this._clone(new PointText(this._matrix))},getPoint:function(){return LinkedPoint.create(this,"setPoint",this._point.x,this._point.y)},setPoint:function(e){this.translate(Point.read(arguments).subtract(this._point))},_transform:function(e){e._transformPoint(this._point,this._point)},draw:function(e){if(!this._content)return;this._setStyles(e);var t=this._style,n=this.getLeading(),r=this._lines;e.font=t.getFontStyle(),e.textAlign=this.getJustification();for(var i=0,s=r.length;i<s;i++){var o=r[i];t._fillColor&&e.fillText(o,0,0),t._strokeColor&&e.strokeText(o,0,0),e.translate(0,n)}}},new function(){var e=null;return{_getBounds:function(t,n){e||(e=CanvasProvider.getCanvas(Size.create(1,1)).getContext("2d"));var r=this.getJustification(),i=0;e.font=this._style.getFontStyle();var s=0;for(var o=0,u=this._lines.length;o<u;o++)s=Math.max(s,e.measureText(this._lines[o]).width);r!=="left"&&(i-=s/(r==="center"?2:1));var a=this.getLeading(),f=this._lines.length,l=Rectangle.create(i,f?a/4+(f-1)*a:0,s,-f*a);return n?n._transformBounds(l,l):l}}}),Style=Item.extend({initialize:function(e){var t=e instanceof Style;return Base.each(this._defaults,function(n,r){n=e&&e[r]||n,this[r]=n&&t&&n.clone?n.clone():n},this)},statics:{create:function(e){var t=new this(this.dont);return t._item=e,t},extend:function(e){var t="_"+e._style,n=Base.capitalize(e._style),r=e._flags||{},i={};return i["get"+n]=function(){return this[t]},i["set"+n]=function(e){this[t].initialize(e)},Base.each(e._defaults,function(n,s){var o=!!s.match(/Color$/),u=Base.capitalize(s),a="set"+u,f="get"+u;e[a]=function(e){var n=this._item&&this._item._children;e=o?Color.read(arguments):e;if(n)for(var i=0,u=n.length;i<u;i++)n[i][t][a](e);else{var f=this["_"+s];f!=e&&!(f&&f.equals&&f.equals(e))&&(this["_"+s]=e,o&&(f&&f._removeOwner(this._item),e&&e._addOwner(this._item)),this._item&&this._item._changed(r[s]||Change.STYLE))}return this},e[f]=function(){var e=this._item&&this._item._children,n;if(!e)return this["_"+s];for(var r=0,i=e.length;r<i;r++){var o=e[r][t][f]();if(!n)n=o;else if(n!=o&&!(n&&n.equals&&n.equals(o)))return undefined}return n},i[a]=function(e){return this[t][a](e),this},i[f]=function(){return this[t][f]()}}),e._owner.inject(i),this.base.apply(this,arguments)}}}),PathStyle=this.PathStyle=Style.extend({_owner:Item,_style:"style",_defaults:{fillColor:undefined,strokeColor:undefined,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[]},_flags:{strokeWidth:Change.STROKE,strokeCap:Change.STROKE,strokeJoin:Change.STROKE,miterLimit:Change.STROKE}}),ParagraphStyle=this.ParagraphStyle=Style.extend({_owner:TextItem,_style:"paragraphStyle",_defaults:{justification:"left"},_flags:{justification:Change.GEOMETRY}}),CharacterStyle=this.CharacterStyle=PathStyle.extend({_owner:TextItem,_style:"style",_defaults:Base.merge(PathStyle.prototype._defaults,{fillColor:"black",fontSize:12,leading:null,font:"sans-serif"}),_flags:{fontSize:Change.GEOMETRY,leading:Change.GEOMETRY,font:Change.GEOMETRY}},{getLeading:function(){var e=this.base();return e!=null?e:this.getFontSize()*1.2},getFontStyle:function(){return this._fontSize+"px "+this._font}}),Color=this.Color=Base.extend(new function(){function r(e){var r=t[e];if(r)return r.clone();if(!n){var i=CanvasProvider.getCanvas(Size.create(1,1));n=i.getContext("2d"),n.globalCompositeOperation="copy"}n.fillStyle="rgba(0,0,0,0)",n.fillStyle=e,n.fillRect(0,0,1,1);var s=n.getImageData(0,0,1,1).data,o=[s[0]/255,s[1]/255,s[2]/255];return(t[e]=RgbColor.read(o)).clone()}function i(e){var t=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);if(t.length>=4){var n=new Array(3);for(var r=0;r<3;r++){var i=t[r+1];n[r]=parseInt(i.length==1?i+i:i,16)/255}return RgbColor.read(n)}}var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"]},t={},n,s=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(e){var t=e._red,n=e._green,r=e._blue,i=Math.max(t,n,r),s=Math.min(t,n,r),o=i-s,u=o==0?0:(i==t?(n-r)/o+(n<r?6:0):i==n?(r-t)/o+2:(t-n)/o+4)*60,a=i==0?0:o/i,f=i;return new HsbColor(u,a,f,e._alpha)},"hsb-rgb":function(e){var t=e._hue/60%6,n=e._saturation,r=e._brightness,i=Math.floor(t),o=t-i,i=s[i],u=[r,r*(1-n),r*(1-n*o),r*(1-n*(1-o))];return new RgbColor(u[i[0]],u[i[1]],u[i[2]],e._alpha)},"rgb-hsl":function(e){var t=e._red,n=e._green,r=e._blue,i=Math.max(t,n,r),s=Math.min(t,n,r),o=i-s,u=o==0,a=u?0:(i==t?(n-r)/o+(n<r?6:0):i==n?(r-t)/o+2:(t-n)/o+4)*60,f=(i+s)/2,l=u?0:f<.5?o/(i+s):o/(2-i-s);return new HslColor(a,l,f,e._alpha)},"hsl-rgb":function(e){var t=e._saturation,n=e._hue/360,r=e._lightness,i,s,o;if(t==0)return new RgbColor(r,r,r,e._alpha);var u=[n+1/3,n,n-1/3],s=r<.5?r*(1+t):r+t-r*t,i=2*r-s,o=[];for(var a=0;a<3;a++){var f=u[a];f<0&&(f+=1),f>1&&(f-=1),o[a]=6*f<1?i+(s-i)*6*f:2*f<1?s:3*f<2?i+(s-i)*(2/3-f)*6:i}return new RgbColor(o[0],o[1],o[2],e._alpha)},"rgb-gray":function(e){return new GrayColor(1-(e._red*.2989+e._green*.587+e._blue*.114),e._alpha)},"gray-rgb":function(e){var t=1-e._gray;return new RgbColor(t,t,t,e._alpha)},"gray-hsb":function(e){return new HsbColor(0,0,1-e._gray,e._alpha)},"gray-hsl":function(e){return new HslColor(0,0,1-e._gray,e._alpha)}},u={_readNull:!0,initialize:function(e){var t=Array.isArray(e),n=this._colorType;if(typeof e=="object"&&!t)return n?Color.read(arguments).convert(n):e.red!==undefined?new RgbColor(e.red,e.green,e.blue,e.alpha):e.gray!==undefined?new GrayColor(e.gray,e.alpha):e.lightness!==undefined?new HslColor(e.hue,e.saturation,e.lightness,e.alpha):e.hue!==undefined?new HsbColor(e.hue,e.saturation,e.brightness,e.alpha):new RgbColor;if(typeof e=="string"){var s=e.match(/^#[0-9a-f]{3,6}$/i)?i(e):r(e);return n?s.convert(n):s}var o=t?e:Array.prototype.slice.call(arguments);if(!n)return o.length>=3?new RgbColor(o):new GrayColor(o);Base.each(this._components,function(e,t){var n=o[t];this["_"+e]=n!==undefined?n:null},this)},clone:function(){var e=this.constructor,t=new e(e.dont),n=this._components;for(var r=0,i=n.length;r<i;r++){var s="_"+n[r];t[s]=this[s]}return t},convert:function(e){var t;return this._colorType==e?this.clone():(t=o[this._colorType+"-"+e])?t(this):o["rgb-"+e](o[this._colorType+"-rgb"](this))},statics:{extend:function(t){if(t._colorType){var n=e[t._colorType];t._components=n.concat(["alpha"]),Base.each(n,function(e){var t=e==="hue",n=Base.capitalize(e),e="_"+e;this["get"+n]=function(){return this[e]},this["set"+n]=function(n){return this[e]=t?(n%360+360)%360:Math.min(Math.max(n,0),1),this._changed(),this}},t)}return this.base(t)}}};return Base.each(e,function(e,t){Base.each(e,function(e){var n=Base.capitalize(e);u["get"+n]=function(){return this.convert(t)[e]},u["set"+n]=function(n){var r=this.convert(t);r[e]=n,r=r.convert(this._colorType);for(var i=0,s=this._components.length;i<s;i++){var o=this._components[i];this[o]=r[o]}}})}),u},{_changed:function(){this._cssString=null;for(var e=0,t=this._owners&&this._owners.length;e<t;e++)this._owners[e]._changed(Change.STYLE)},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var t=this._owners?this._owners.indexOf(e):-1;t!=-1&&(this._owners.splice(t,1),this._owners.length==0&&delete this._owners)},getType:function(){return this._colorType},getComponents:function(){var e=this._components.length,t=new Array(e);for(var n=0;n<e;n++)t[n]=this["_"+this._components[n]];return t},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(e){return this._alpha=e==null?null:Math.min(Math.max(e,0),1),this._changed(),this},hasAlpha:function(){return this._alpha!=null},equals:function(e){if(e&&e._colorType===this._colorType){for(var t=0,n=this._components.length;t<n;t++){var r="_"+this._components[t];if(this[r]!==e[r])return!1}return!0}return!1},toString:function(){var e=[],t=Base.formatNumber;for(var n=0,r=this._components.length;n<r;n++){var i=this._components[n],s=this["_"+i];i==="alpha"&&s==null&&(s=1),e.push(i+": "+t(s))}return"{ "+e.join(", ")+" }"},toCssString:function(){if(!this._cssString){var e=this.convert("rgb"),t=e.getAlpha(),n=[Math.round(e._red*255),Math.round(e._green*255),Math.round(e._blue*255),t!=null?t:1];this._cssString="rgba("+n.join(", ")+")"}return this._cssString},getCanvasStyle:function(){return this.toCssString()}}),GrayColor=this.GrayColor=Color.extend({_colorType:"gray"}),RgbColor=this.RgbColor=this.RGBColor=Color.extend({_colorType:"rgb"}),HsbColor=this.HsbColor=this.HSBColor=Color.extend({_colorType:"hsb"}),HslColor=this.HslColor=this.HSLColor=Color.extend({_colorType:"hsl"}),GradientColor=this.GradientColor=Color.extend({initialize:function(e,t,n,r){this.gradient=e||new Gradient,this.gradient._addOwner(this),this.setOrigin(t),this.setDestination(n),r&&this.setHilite(r)},clone:function(){return new GradientColor(this.gradient,this._origin,this._destination,this._hilite)},getOrigin:function(){return this._origin},setOrigin:function(e){return e=Point.read(arguments).clone(),this._origin=e,this._destination&&(this._radius=this._destination.getDistance(this._origin)),this._changed(),this},getDestination:function(){return this._destination},setDestination:function(e){return e=Point.read(arguments).clone(),this._destination=e,this._radius=this._destination.getDistance(this._origin),this._changed(),this},getHilite:function(){return this._hilite},setHilite:function(e){e=Point.read(arguments).clone();var t=e.subtract(this._origin);return t.getLength()>this._radius?this._hilite=this._origin.add(t.normalize(this._radius-.1)):this._hilite=e,this._changed(),this},getCanvasStyle:function(e){var t;if(this.gradient.type==="linear")t=e.createLinearGradient(this._origin.x,this._origin.y,this._destination.x,this._destination.y);else{var n=this._hilite||this._origin;t=e.createRadialGradient(n.x,n.y,0,this._origin.x,this._origin.y,this._radius)}for(var r=0,i=this.gradient._stops.length;r<i;r++){var s=this.gradient._stops[r];t.addColorStop(s._rampPoint,s._color.toCssString())}return t},equals:function(e){return e==this||e&&e._colorType===this._colorType&&this.gradient.equals(e.gradient)&&this._origin.equals(e._origin)&&this._destination.equals(e._destination)},transform:function(e){e._transformPoint(this._origin,this._origin,!0),e._transformPoint(this._destination,this._destination,!0),this._hilite&&e._transformPoint(this._hilite,this._hilite,!0),this._radius=this._destination.getDistance(this._origin)}}),Gradient=this.Gradient=Base.extend({initialize:function(e,t){this.setStops(e||["white","black"]),this.type=t||"linear"},_changed:function(){for(var e=0,t=this._owners&&this._owners.length;e<t;e++)this._owners[e]._changed()},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var t=this._owners?this._owners.indexOf(e):-1;t!=-1&&(this._owners.splice(t,1),this._owners.length==0&&delete this._owners)},clone:function(){var e=[];for(var t=0,n=this._stops.length;t<n;t++)e[t]=this._stops[t].clone();return new Gradient(e,this.type)},getStops:function(){return this._stops},setStops:function(e){if(this.stops)for(var t=0,n=this._stops.length;t<n;t++)this._stops[t]._removeOwner(this);if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(e);for(var t=0,n=this._stops.length;t<n;t++){var r=this._stops[t];r._addOwner(this),r._defaultRamp&&r.setRampPoint(t/(n-1))}this._changed()},equals:function(e){if(e.type!=this.type)return!1;if(this._stops.length==e._stops.length){for(var t=0,n=this._stops.length;t<n;t++)if(!this._stops[t].equals(e._stops[t]))return!1;return!0}return!1}}),GradientStop=this.GradientStop=Base.extend({initialize:function(e,t){t===undefined&&Array.isArray(e)?(this.setColor(e[0]),this.setRampPoint(e[1])):e.color?(this.setColor(e.color),this.setRampPoint(e.rampPoint)):(this.setColor(e),this.setRampPoint(t))},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_changed:function(){for(var e=0,t=this._owners&&this._owners.length;e<t;e++)this._owners[e]._changed(Change.STYLE)},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var t=this._owners?this._owners.indexOf(e):-1;t!=-1&&(this._owners.splice(t,1),this._owners.length==0&&delete this._owners)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(e){this._defaultRamp=e==null,this._rampPoint=e||0,this._changed()},getColor:function(){return this._color},setColor:function(e){this._color&&this._color._removeOwner(this),this._color=Color.read(arguments),this._color._addOwner(this),this._changed()},equals:function(e){return e==this||e instanceof GradientStop&&this._color.equals(e._color)&&this._rampPoint==e._rampPoint}}),DomElement={getBounds:function(e,t){var n=e.getBoundingClientRect(),r=e.ownerDocument,i=r.body,s=r.documentElement,o=n.left-(s.clientLeft||i.clientLeft||0),u=n.top-(s.clientTop||i.clientTop||0);if(!t){var a=DomElement.getViewport(r);o+=a.pageXOffset||s.scrollLeft||i.scrollLeft,u+=a.pageYOffset||s.scrollTop||i.scrollTop}return new Rectangle(o,u,n.width,n.height)},getOffset:function(e,t){return this.getBounds(e,t).getPoint()},getSize:function(e){return this.getBounds(e,!0).getSize()},isInvisible:function(e){return this.getSize(e).equals([0,0])},isVisible:function(e){return!this.isInvisible(e)&&this.getViewportBounds(e).intersects(this.getBounds(e,!0))},getViewport:function(e){return e.defaultView||e.parentWindow},getViewportBounds:function(e){var t=e.ownerDocument,n=this.getViewport(t),r=t.getElementsByTagName(t.compatMode==="CSS1Compat"?"html":"body")[0];return Rectangle.create(0,0,n.innerWidth||r.clientWidth,n.innerHeight||r.clientHeight)},getComputedStyle:function(e,t){if(e.currentStyle)return e.currentStyle[Base.camelize(t)];var n=this.getViewport(e.ownerDocument).getComputedStyle(e,null);return n?n.getPropertyValue(Base.hyphenate(t)):null}},DomEvent={add:function(e,t){for(var n in t){var r=t[n];e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent&&e.attachEvent("on"+n,r.bound=function(){r.call(e,window.event)})}},remove:function(e,t){for(var n in t){var r=t[n];e.removeEventListener?e.removeEventListener(n,r,!1):e.detachEvent&&e.detachEvent("on"+n,r.bound)}},getPoint:function(e){var t=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return Point.create(t.pageX||t.clientX+document.documentElement.scrollLeft,t.pageY||t.clientY+document.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getOffset:function(e,t){return DomEvent.getPoint(e).subtract(DomElement.getOffset(t||DomEvent.getTarget(e)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},stop:function(e){DomEvent.stopPropagation(e),DomEvent.preventDefault(e)}};DomEvent.requestAnimationFrame=new function(){var e="equestAnimationFrame",t=window["r"+e]||window["webkitR"+e]||window["mozR"+e]||window["oR"+e]||window["msR"+e];t&&t(function(e){e==undefined&&(t=null)});var n=[],r=!0,i;return DomEvent.add(window,{focus:function(){r=!0},blur:function(){r=!1}}),function(e,s){if(t)return t(e,s);n.push([e,s]);if(i)return;i=window.setInterval(function(){for(var e=n.length-1;e>=0;e--){var t=n[e],i=t[0],s=t[1];if(!s||(PaperScript.getAttribute(s,"keepalive")=="true"||r)&&DomElement.isVisible(s))n.splice(e,1),i(Date.now())}},1e3/60)}};var View=this.View=Base.extend(Callback,{_events:{onFrame:{install:function(){var e=this,t=!1,n,r=0,i=0;this._onFrameCallback=function(s,o){t=!1;if(!e._onFrameCallback)return;paper=e._scope,o||(t=!0,DomEvent.requestAnimationFrame(e._onFrameCallback,e._element));var u=Date.now()/1e3,a=n?u-n:0;e.fire("frame",Base.merge({delta:a,time:r+=a,count:i++})),n=u,e._stats&&e._stats.update(),e.draw(!0)},t||this._onFrameCallback()},uninstall:function(){delete this._onFrameCallback}},onResize:{}},initialize:function(e){this._scope=paper,this._project=paper.project,this._element=e;var t;this._id=e.getAttribute("id"),this._id==null&&e.setAttribute("id",this._id="view-"+View._id++),DomEvent.add(e,this._handlers);if(PaperScript.hasAttribute(e,"resize")){var n=DomElement.getOffset(e,!0),r=this;t=DomElement.getViewportBounds(e).getSize().subtract(n),e.width=t.width,e.height=t.height,DomEvent.add(window,{resize:function(t){DomElement.isInvisible(e)||(n=DomElement.getOffset(e,!0)),r.setViewSize(DomElement.getViewportBounds(e).getSize().subtract(n))}})}else t=DomElement.isInvisible(e)?Size.create(parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height"))):DomElement.getSize(e);if(PaperScript.hasAttribute(e,"stats")){this._stats=new Stats;var i=this._stats.domElement,s=i.style,n=DomElement.getOffset(e);s.position="absolute",s.left=n.x+"px",s.top=n.y+"px",document.body.appendChild(i)}View._views.push(this),View._viewsById[this._id]=this,this._viewSize=LinkedSize.create(this,"setViewSize",t.width,t.height),this._matrix=new Matrix,this._zoom=1,View._focused||(View._focused=this)},remove:function(){return this._project?(View._focused==this&&(View._focused=null),View._views.splice(View._views.indexOf(this),1),delete View._viewsById[this._id],this._project.view==this&&(this._project.view=null),DomEvent.remove(this._element,this._handlers),this._element=this._project=null,this.detach("frame"),!0):!1},_redraw:function(){this._redrawNeeded=!0,this._onFrameCallback?this._onFrameCallback(0,!0):this.draw()},_transform:function(e){this._matrix.preConcatenate(e),this._bounds=null,this._inverse=null,this._redraw()},getElement:function(){return this._element},getViewSize:function(){return this._viewSize},setViewSize:function(e){e=Size.read(arguments);var t=e.subtract(this._viewSize);if(t.isZero())return;this._element.width=e.width,this._element.height=e.height,this._viewSize.set(e.width,e.height,!0),this._bounds=null,this._redrawNeeded=!0,this.fire("resize",{size:e,delta:t}),this._redraw()},getBounds:function(){return this._bounds||(this._bounds=this._getInverse()._transformBounds(new Rectangle(new Point,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(e){this.scrollBy(Point.read(arguments).subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(e){this._transform((new Matrix).scale(e/this._zoom,this.getCenter())),this._zoom=e},isVisible:function(){return DomElement.isVisible(this._element)},scrollBy:function(e){this._transform((new Matrix).translate(Point.read(arguments).negate()))},projectToView:function(e){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(e){return this._getInverse()._transformPoint(Point.read(arguments))},_getInverse:function(){return this._inverse||(this._inverse=this._matrix.createInverse()),this._inverse}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e){return typeof e=="string"&&(e=document.getElementById(e)),new CanvasView(e)}}},new function(){function i(e){return View._viewsById[DomEvent.getTarget(e).getAttribute("id")]}function s(e,t){return e.viewToProject(DomEvent.getOffset(t,e._element))}function o(){if(!View._focused||!View._focused.isVisible())for(var e=0,t=View._views.length;e<t;e++){var r=View._views[e];if(r&&r.isVisible()){View._focused=n=r;break}}}function u(n){var o=View._focused=i(n);t=s(o,n),r=!0,o._onMouseDown&&o._onMouseDown(n,t),(e=o._scope.tool)&&e._onHandleEvent("mousedown",t,n),o.draw(!0)}function a(u){var a;r||(a=i(u),a?View._focused=n=a:n&&n==View._focused&&(View._focused=null,o()));if(!(a=a||View._focused))return;var f=u&&s(a,u);a._onMouseMove&&a._onMouseMove(u,f);if(e=a._scope.tool){var l=!e.onMouseDrag&&!!e.onMouseMove;r&&!l?(t=f||t)&&e._onHandleEvent("mousedrag",t,u)&&DomEvent.stop(u):(!r||l)&&e._onHandleEvent("mousemove",f,u)&&DomEvent.stop(u)}a.draw(!0)}function f(n){var i=View._focused;if(!i||!r)return;var o=s(i,n);t=null,r=!1,i._onMouseUp&&i._onMouseUp(n,o),e&&e._onHandleEvent("mouseup",o,n)&&DomEvent.stop(n),i.draw(!0)}function l(e){r&&DomEvent.stop(e)}var e,t,n,r=!1;return DomEvent.add(document,{mousemove:a,mouseup:f,touchmove:a,touchend:f,selectstart:l,scroll:o}),DomEvent.add(window,{load:o}),{_handlers:{mousedown:u,touchstart:u,selectstart:l},statics:{updateFocus:o}}}),CanvasView=View.extend({initialize:function(e){if(!(e instanceof HTMLCanvasElement)){var t=Size.read(arguments,1);t.isZero()&&(t=Size.create(1024,768)),e=CanvasProvider.getCanvas(t)}this._context=e.getContext("2d"),this._eventCounters={},this.base(e)},draw:function(e){if(e&&!this._redrawNeeded)return!1;var t=this._context,n=this._viewSize;return t.clearRect(0,0,n._width+1,n._height+1),this._project.draw(t,this._matrix),this._redrawNeeded=!1,!0}},new function(){function f(e,t,n,r,i,s){var o=r,u,a=!1;while(o){if(o.responds(e)){u||(u=new MouseEvent(e,t,n,r,i?n.subtract(i):null)),a=o.fire(e,u)||a;if(a&&(!s||u._stopped))break}o=o.getParent()}return a}function l(t,n,r,i,u){if(t._eventCounters[n]){var a=t._project.hitTest(i,e),l=a&&a.item;if(l)return n=="mousemove"&&l!=s&&(u=i),(n!="mousemove"||!o)&&f(n,r,i,l,u),l}}var e={fill:!0,stroke:!0,tolerance:0},t,n,r,i,s,o,u,a;return{_onMouseDown:function(e,s){var f=l(this,"mousedown",e,s);u=i==f&&Date.now()-a<300,i=f,t=n=r=s,o=i&&i.responds("mousedrag")},_onMouseUp:function(e,c){var h=l(this,"mouseup",e,c);o&&(n&&!n.equals(c)&&f("mousedrag",e,c,i,n),h!=i&&(r=c,f("mousemove",e,c,h,r))),h==i&&(a=Date.now(),f(u?"doubleclick":"click",e,t,s),u=!1),i=null,o=!1},_onMouseMove:function(e,t){i&&f("mousedrag",e,t,i,n);var o=l(this,"mousemove",e,t,r);n=r=t,o!=s&&(f("mouseleave",e,t,s),s=o,f("mouseenter",e,t,o))}}}),Event=this.Event=Base.extend({initialize:function(e){this.event=e},preventDefault:function(){return this._prevented=!0,DomEvent.preventDefault(this.event),this},stopPropagation:function(){return this._stopped=!0,DomEvent.stopPropagation(this.event),this},stop:function(){return this.stopPropagation().preventDefault()},getModifiers:function(){return Key.modifiers}}),KeyEvent=this.KeyEvent=Event.extend({initialize:function(e,t,n,r){this.base(r),this.type=e?"keydown":"keyup",this.key=t,this.character=n},toString:function(){return"{ type: "+this.type+", key: "+this.key+", character: "+this.character+", modifiers: "+this.getModifiers()+" }"}}),Key=this.Key=new function(){function s(t,n,i,s){var o=String.fromCharCode(i),u=e[n]||o.toLowerCase(),a=t?"keydown":"keyup",f=View._focused,l=f&&f.isVisible()&&f._scope,c=l&&l.tool;r[u]=t,c&&c.responds(a)&&(c.fire(a,new KeyEvent(t,u,o,s)),f&&f.draw(!0))}var e={8:"backspace",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},t=Base.merge({shift:!1,control:!1,option:!1,command:!1,capsLock:!1}),n={},r={},i;return DomEvent.add(document,{keydown:function(r){var o=r.which||r.keyCode,u=e[o],a;u?((a=Base.camelize(u))in t&&(t[a]=!0),n[o]=0,s(!0,o,null,r)):i=o},keypress:function(e){if(i!=null){var t=e.which||e.keyCode;n[i]=t,s(!0,i,t,e),i=null}},keyup:function(r){var i=r.which||r.keyCode,o=e[i],u;o&&(u=Base.camelize(o))in t&&(t[u]=!1),n[i]!=null&&(s(!1,i,n[i],r),delete n[i])}}),{modifiers:t,isDown:function(e){return!!r[e]}}},MouseEvent=this.MouseEvent=Event.extend({initialize:function(e,t,n,r,i){this.base(t),this.type=e,this.point=n,this.target=r,this.delta=i},toString:function(){return"{ type: "+this.type+", point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),ToolEvent=this.ToolEvent=Event.extend({initialize:function(e,t,n){this.tool=e,this.type=t,this.event=n},_choosePoint:function(e,t){return e?e:t?t.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this.middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){var t=e.item,n=t._parent;while(n instanceof Group&&!(n instanceof Layer)||n instanceof CompoundPath)t=n,n=n._parent;this._item=t}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=this.Tool=PaperScopeItem.extend(Callback,{_list:"tools",_reference:"_tool",_events:["onEditOptions","onSelect","onDeselect","onReselect","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(){this.base(),this._firstMove=!0,this._count=0,this._downCount=0},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,this._minDistance!=null&&this._maxDistance!=null&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,this._minDistance!=null&&this._maxDistance!=null&&this._maxDistance<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=e,this._maxDistance=e},_updateEvent:function(e,t,n,r,i,s,o){if(!i){if(n!=null||r!=null){var u=n!=null?n:0,a=t.subtract(this._point),f=a.getLength();if(f<u)return!1;var l=r!=null?r:0;if(l!=0)if(f>l)t=this._point.add(a.normalize(l));else if(o)return!1}if(s&&t.equals(this._point))return!1}this._lastPoint=i&&e=="mousemove"?t:this._point,this._point=t;switch(e){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=i?0:this._count+1,!0},_onHandleEvent:function(e,t,n){paper=this._scope;var r=Tool._removeSets;if(r){e==="mouseup"&&(r.mousedrag=null);var i=r[e];if(i){for(var s in i){var o=i[s];for(var u in r){var a=r[u];a&&a!=i&&a[o._id]&&delete a[o._id]}o.remove()}r[e]=null}}var f=!1;switch(e){case"mousedown":this._updateEvent(e,t,null,null,!0,!1,!1),this.responds(e)&&(f=this.fire(e,new ToolEvent(this,e,n)));break;case"mousedrag":var l=!1,c=!1;while(this._updateEvent(e,t,this.minDistance,this.maxDistance,!1,l,c))this.responds(e)&&(f=this.fire(e,new ToolEvent(this,e,n))),l=!0,c=!0;break;case"mouseup":(this._point.x!=t.x||this._point.y!=t.y)&&this._updateEvent("mousedrag",t,this.minDistance,this.maxDistance,!1,!1,!1)&&this.responds("mousedrag")&&(f=this.fire("mousedrag",new ToolEvent(this,e,n))),this._updateEvent(e,t,null,this.maxDistance,!1,!1,!1),this.responds(e)&&(f=this.fire(e,new ToolEvent(this,e,n))),this._updateEvent(e,t,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":while(this._updateEvent(e,t,this.minDistance,this.maxDistance,this._firstMove,!0,!1))this.responds(e)&&(f=this.fire(e,new ToolEvent(this,e,n))),this._firstMove=!1}return f}}),CanvasProvider={canvases:[],getCanvas:function(e){if(this.canvases.length){var t=this.canvases.pop();return t.width!=e.width||t.height!=e.height?(t.width=e.width,t.height=e.height):t.getContext("2d").clearRect(0,0,e.width+1,e.height+1),t}var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t},returnCanvas:function(e){this.canvases.push(e)}},Numerical=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],t=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,r=Math.sqrt,i=Math.cos,s=Math.PI;return{TOLERANCE:1e-5,EPSILON:1e-11,integrate:function(n,r,i,s){var o=e[s-2],u=t[s-2],a=.5*(i-r),f=a+r,l=0,c=s+1>>1,h=s&1?u[l++]*n(f):0;while(l<c){var p=a*o[l];h+=u[l++]*(n(f+p)+n(f-p))}return a*h},findRoot:function(e,t,r,i,s,o,u){for(var a=0;a<o;a++){var f=e(r),l=f/t(r);if(n(l)<u)return r;var c=r-l;f>0?(s=r,r=c<=i?.5*(i+s):c):(i=r,r=c>=s?.5*(i+s):c)}},solveQuadratic:function(e,t,i,s,o){if(n(e)<o)return n(t)>=o?(s[0]=-i/t,1):n(i)<o?-1:0;var u=t*t-4*e*i;if(u<0)return 0;u=r(u),t<0&&(u=-u),u=(t+u)*-0.5;var a=0;return n(u)>=o&&(s[a++]=i/u),n(e)>=o&&(s[a++]=u/e),a},solveCubic:function(e,t,o,u,a,f){if(n(e)<f)return Numerical.solveQuadratic(t,o,u,a,f);t/=e,o/=e,u/=e;var l=(t*t-3*o)/9,c=(2*t*t*t-9*t*o+27*u)/54,h=l*l*l,p=c*c;t/=3;if(p<h){var d=Math.acos(c/r(h)),v=-2*r(l);return a[0]=v*i(d/3)-t,a[1]=v*i((d+2*s)/3)-t,a[2]=v*i((d-2*s)/3)-t,3}var m=-Math.pow(n(c)+r(p-h),1/3);c<0&&(m=-m);var g=n(m)<f?0:l/m;return a[0]=m+g-t,1}}},BlendMode={process:function(e,t,n,r,i){function x(e,t,n){return.2989*e+.587*t+.114*n}function T(e,t,n,r){var i=r-x(e,t,n);w=e+i,E=t+i,S=n+i;var r=x(w,E,S),s=f(w,E,S),o=l(w,E,S);if(s<0){var u=r-s;w=r+(w-r)*r/u,E=r+(E-r)*r/u,S=r+(S-r)*r/u}if(o>255){var a=255-r,c=o-r;w=r+(w-r)*a/c,E=r+(E-r)*a/c,S=r+(S-r)*a/c}}function N(e,t,n){return l(e,t,n)-f(e,t,n)}function C(e,t,n,r){var i=[e,t,n],s=l(e,t,n),o=f(e,t,n),u;o=o==e?0:o==t?1:2,s=s==e?0:s==t?1:2,u=f(o,s)==0?l(o,s)==1?2:1:0,i[s]>i[o]?(i[u]=(i[u]-i[o])*r/(i[s]-i[o]),i[s]=r):i[u]=i[s]=0,i[o]=0,w=i[0],E=i[1],S=i[2]}var s=t.canvas,o=n.getImageData(i.x,i.y,s.width,s.height),u=o.data,a=t.getImageData(0,0,s.width,s.height).data,f=Math.min,l=Math.max,c=Math.abs,h,p,d,v,m,g,y,b,w,E,S,k={multiply:function(){w=m*h/255,E=g*p/255,S=y*d/255},screen:function(){w=255-(255-m)*(255-h)/255,E=255-(255-g)*(255-p)/255,S=255-(255-y)*(255-d)/255},overlay:function(){w=m<128?2*m*h/255:255-2*(255-m)*(255-h)/255,E=g<128?2*g*p/255:255-2*(255-g)*(255-p)/255,S=y<128?2*y*d/255:255-2*(255-y)*(255-d)/255},"soft-light":function(){var e=h*m/255;w=e+m*(255-(255-m)*(255-h)/255-e)/255,e=p*g/255,E=e+g*(255-(255-g)*(255-p)/255-e)/255,e=d*y/255,S=e+y*(255-(255-y)*(255-d)/255-e)/255},"hard-light":function(){w=h<128?2*h*m/255:255-2*(255-h)*(255-m)/255,E=p<128?2*p*g/255:255-2*(255-p)*(255-g)/255,S=d<128?2*d*y/255:255-2*(255-d)*(255-y)/255},"color-dodge":function(){w=h==255?h:f(255,m*255/(255-h)),E=p==255?p:f(255,g*255/(255-p)),S=d==255?d:f(255,y*255/(255-d))},"color-burn":function(){w=h==0?0:l(255-(255-m)*255/h,0),E=p==0?0:l(255-(255-g)*255/p,0),S=d==0?0:l(255-(255-y)*255/d,0)},darken:function(){w=m<h?m:h,E=g<p?g:p,S=y<d?y:d},lighten:function(){w=m>h?m:h,E=g>p?g:p,S=y>d?y:d},difference:function(){w=m-h,w<0&&(w=-w),E=g-p,E<0&&(E=-E),S=y-d,S<0&&(S=-S)},exclusion:function(){w=m+h*(255-m-m)/255,E=g+p*(255-g-g)/255,S=y+d*(255-y-y)/255},hue:function(){C(h,p,d,N(m,g,y)),T(w,E,S,x(m,g,y))},saturation:function(){C(m,g,y,N(h,p,d)),T(w,E,S,x(m,g,y))},luminosity:function(){T(m,g,y,x(h,p,d))},color:function(){T(h,p,d,x(m,g,y))},add:function(){w=f(m+h,255),E=f(g+p,255),S=f(y+d,255)},subtract:function(){w=l(m-h,0),E=l(g-p,0),S=l(y-d,0)},average:function(){w=(m+h)/2,E=(g+p)/2,S=(y+d)/2},negation:function(){w=255-c(255-h-m),E=255-c(255-p-g),S=255-c(255-d-y)}},L=k[e];if(!L)return;for(var A=0,O=u.length;A<O;A+=4){h=a[A],m=u[A],p=a[A+1],g=u[A+1],d=a[A+2],y=u[A+2],v=a[A+3],b=u[A+3],L();var M=v*r/255,_=1-M;u[A]=M*w+_*m,u[A+1]=M*E+_*g,u[A+2]=M*S+_*y,u[A+3]=v*r+_*b}n.putImageData(o,i.x,i.y)}},PaperScript=this.PaperScript=new function(){function $eval(e,t,n){var r=operators[t];if(e&&e[r]){var i=e[r](n);return t=="!="?!i:i}switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"==":return e==n;case"!=":return e!=n;default:throw new Error("Implement Operator: "+t)}}function $sign(e,t){var n=signOperators[e];if(t&&t[n])return t[n]();switch(e){case"+":return+t;case"-":return-t;default:throw new Error("Implement Sign Operator: "+e)}}function isDynamic(e){var t=e[0];return t!="num"&&t!="string"}function handleOperator(e,t,n){if(operators[e]&&isDynamic(t))return["call",["name","$eval"],[t,["string",e],n]]}function compile(e){var t=parse_js.parse(e),n=parse_js.ast_walker(),r=n.walk;return t=n.with_walkers({binary:function(e,t,n){return handleOperator(e,t=r(t),n=r(n))||[this[0],e,t,n]},assign:function(e,t,n){var i=handleOperator(e,t=r(t),n=r(n));return i?[this[0],!0,t,i]:[this[0],e,t,n]},"unary-prefix":function(e,t){if(signOperators[e]&&isDynamic(t))return["call",["name","$sign"],[["string",e],r(t)]]}},function(){return r(t)}),parse_js.gen_code(t,{beautify:!0})}function evaluate(code,scope){paper=scope;var view=scope.project.view,res;with(scope)(function(){var onEditOptions,onSelect,onDeselect,onReselect,onMouseDown,onMouseUp,onMouseDrag,onMouseMove,onKeyDown,onKeyUp,onFrame,onResize;res=eval(compile(code)),/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(code)&&Base.each(Tool.prototype._events,function(key){var value=eval(key);value&&(scope.getTool()[key]=value)}),view&&(view.setOnResize(onResize),view.fire("resize",{size:view.size,delta:new Point}),view.setOnFrame(onFrame),view.draw())}).call(scope);return res}function request(e,t){var n=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain"),n.onreadystatechange=function(){if(n.readyState===4)return evaluate(n.responseText,t)},n.send(null)}function load(){var e=document.getElementsByTagName("script");for(var t=0,n=e.length;t<n;t++){var r=e[t];if(/^text\/(?:x-|)paperscript$/.test(r.type)&&!r.getAttribute("data-paper-loaded")){var i=new PaperScope(r);i.setup(PaperScript.getAttribute(r,"canvas")),r.src?request(r.src,i):evaluate(r.innerHTML,i),r.setAttribute("data-paper-loaded",!0)}}}function handleAttribute(e){return e+="Attribute",function(t,n){return t[e](n)||t[e]("data-paper-"+n)}}var parse_js=new function(){function e(e,t,n){var r=[];for(var i=0;i<e.length;++i)r.push(t.call(n,e[i],i));return r}function t(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)&&e!="this"&&!a(O,e)&&!a(L,e)&&!a(k,e)}function n(e,t){var n={};e===!0&&(e={});for(var r in t)a(t,r)&&(n[r]=e&&a(e,r)?e[r]:t[r]);return n}function r(e,t){return t<1?"":Array(t+1).join(e)}function i(i,l){function h(e){var t=e[0],n=D[t];if(!n)throw new Error("Can't find generator for \""+t+'"');P.push(e);var r=n.apply(t,e.slice(1));return P.pop(),r}function p(e){var t=e[0],n=e[1];return n!=null&&(t=N([L(t),"=",S(n,"seq")])),t}function d(e){return e?e.length==0?"{}":"{"+M+C(function(){return m(e).join(M)})+M+k("}"):";"}function v(t){var n=t.length;return n==0?"{}":"{"+M+e(t,function(e,t){var r=e[1].length>0,i=C(function(){return k(e[0]?N(["case",h(e[0])+":"]):"default:")},.5)+(r?M+C(function(){return m(e[1]).join(M)}):"");return!A&&r&&t<n-1&&(i+=";"),i}).join(M)+M+k("}")}function m(t,n){for(var r=[],i=t.length-1,s=0;s<=i;++s){var u=t[s],a=h(u);a!=";"&&(!A&&s==i&&(u[0]=="while"&&o(u[2])||f(u[0],["for","for-in"])&&o(u[4])||u[0]=="if"&&o(u[2])&&!u[3]||u[0]=="if"&&u[3]&&o(u[3])?a=a.replace(/;*\s*$/,";"):a=a.replace(/;+\s*$/,"")),r.push(a))}return n?r:e(r,k)}function g(t,n,r,i){var s=i||"function";return t&&(s+=" "+L(t)),s+="("+x(e(n,L))+")",N([s,d(r)])}function y(e){if(e[0]=="do")return h(["block",[e]]);var t=e;for(;;){var n=t[0];if(n=="if"){if(!t[3])return h(["block",[e]]);t=t[3]}else if(n=="while"||n=="do")t=t[2];else{if(n!="for"&&n!="for-in")break;t=t[4]}}return h(e)}function b(e){var t=e.toString(10),n=[t.replace(/^0\./,".")],r;return Math.floor(e)===e?(n.push("0x"+e.toString(16).toLowerCase(),"0"+e.toString(8)),(r=/^(.*?)(0+)$/.exec(e))&&n.push(r[1]+"e"+r[2].length)):(r=/^0?\.(0+)(.*)$/.exec(e))&&n.push(r[2]+"e-"+(r[1].length+r[2].length),t.substr(t.indexOf("."))),E(n)}function w(e){if(e[0]=="function"||e[0]=="object"){var t=c(P),n=t.pop(),r=t.pop();while(r){if(r[0]=="stat")return!0;if((r[0]!="seq"&&r[0]!="call"&&r[0]!="dot"&&r[0]!="sub"&&r[0]!="conditional"||r[1]!==n)&&(r[0]!="binary"&&r[0]!="assign"&&r[0]!="unary-postfix"||r[2]!==n))return!1;n=r,r=t.pop()}}return!a($,e[0])}function E(e){if(e.length==1)return e[0];if(e.length==2){var t=e[1];return e=e[0],e.length<=t.length?e:t}return E([e[0],E(e.slice(1))])}function S(e){var t=h(e);for(var n=1;n<arguments.length;++n){var r=arguments[n];if(r instanceof Function&&r(e)||e[0]==r)return"("+t+")"}return t}function x(e){return e.join(","+_)}function N(e){if(A)return e.join(" ");var t=[];for(var n=0;n<e.length;++n){var r=e[n+1];t.push(e[n]),r&&(/[a-z0-9_\x24]$/i.test(e[n].toString())&&/^[a-z0-9_\x24]/i.test(r.toString())||/[\+\-]$/.test(e[n].toString())&&/^[\+\-]/.test(r.toString()))&&t.push(" ")}return t.join("")}function C(e,t){t==null&&(t=1),O+=t;try{return e.apply(null,c(arguments,1))}finally{O-=t}}function k(e){return e==null&&(e=""),A&&(e=r(" ",l.indent_start+O*l.indent_level)+e),e}function L(e){return e.toString()}l=n(l,{indent_start:0,indent_level:4,quote_keys:!1,space_colon:!1,beautify:!1});var A=!!l.beautify,O=0,M=A?"\n":"",_=A?" ":"",D={string:s,num:b,name:L,toplevel:function(e){return m(e).join(M)},splice:function(t){var n=P[P.length-2][0];return a(J,n)?d.apply(this,arguments):e(m(t,!0),function(e,t){return t>0?k(e):e}).join(M)},block:d,"var":function(t){return"var "+x(e(t,p))+";"},"const":function(t){return"const "+x(e(t,p))+";"},"try":function(e,t,n){var r=["try",d(e)];return t&&r.push("catch","("+t[0]+")",d(t[1])),n&&r.push("finally",d(n)),N(r)},"throw":function(e){return N(["throw",h(e)])+";"},"new":function(t,n){return n=n.length>0?"("+x(e(n,h))+")":"",N(["new",S(t,"seq","binary","conditional","assign",function(e){var t=u(),n={};try{t.with_walkers({call:function(){throw n},"function":function(){return this}},function(){t.walk(e)})}catch(r){if(r===n)return!0;throw r}})+n])},"switch":function(e,t){return N(["switch","("+h(e)+")",v(t)])},"break":function(e){var t="break";return e!=null&&(t+=" "+L(e)),t+";"},"continue":function(e){var t="continue";return e!=null&&(t+=" "+L(e)),t+";"},conditional:function(e,t,n){return N([S(e,"assign","seq","conditional"),"?",S(t,"seq"),":",S(n,"seq")])},assign:function(e,t,n){return e&&e!==!0?e+="=":e="=",N([h(t),e,S(n,"seq")])},dot:function(e){var t=h(e),n=1;e[0]=="num"?/\./.test(e[1])||(t+="."):w(e)&&(t="("+t+")");while(n<arguments.length)t+="."+L(arguments[n++]);return t},call:function(t,n){var r=h(t);return w(t)&&(r="("+r+")"),r+"("+x(e(n,function(e){return S(e,"seq")}))+")"},"function":g,defun:g,"if":function(e,t,n){var r=["if","("+h(e)+")",n?y(t):h(t)];return n&&r.push("else",h(n)),N(r)},"for":function(e,t,n,r){var i=["for"];e=(e!=null?h(e):"").replace(/;*\s*$/,";"+_),t=(t!=null?h(t):"").replace(/;*\s*$/,";"+_),n=(n!=null?h(n):"").replace(/;*\s*$/,"");var s=e+t+n;return s=="; ; "&&(s=";;"),i.push("("+s+")",h(r)),N(i)},"for-in":function(e,t,n,r){return N(["for","("+(e?h(e).replace(/;+$/,""):h(t)),"in",h(n)+")",h(r)])},"while":function(e,t){return N(["while","("+h(e)+")",h(t)])},"do":function(e,t){return N(["do",h(t),"while","("+h(e)+")"])+";"},"return":function(e){var t=["return"];return e!=null&&t.push(h(e)),N(t)+";"},binary:function(e,t,n){var r=h(t),i=h(n);if(f(t[0],["assign","conditional","seq"])||t[0]=="binary"&&W[e]>W[t[1]])r="("+r+")";if(f(n[0],["assign","conditional","seq"])||n[0]=="binary"&&W[e]>=W[n[1]]&&(n[1]!=e||!f(e,["&&","||","*"])))i="("+i+")";return N([r,e,i])},"unary-prefix":function(e,t){var n=h(t);return t[0]=="num"||t[0]=="unary-prefix"&&!a(H,e+t[1])||!w(t)||(n="("+n+")"),e+(T(e.charAt(0))?" ":"")+n},"unary-postfix":function(e,t){var n=h(t);return t[0]=="num"||t[0]=="unary-postfix"&&!a(H,e+t[1])||!w(t)||(n="("+n+")"),n+e},sub:function(e,t){var n=h(e);return w(e)&&(n="("+n+")"),n+"["+h(t)+"]"},object:function(n){return n.length==0?"{}":"{"+M+C(function(){return e(n,function(e){if(e.length==3)return k(g(e[0],e[1][2],e[1][3],e[2]));var n=e[0],r=h(e[1]);return l.quote_keys?n=s(n):(typeof n=="number"||!A&&+n+""==n)&&parseFloat(n)>=0?n=b(+n):t(n)||(n=s(n)),k(N(A&&l.space_colon?[n,":",r]:[n+":",r]))}).join(","+M)})+M+k("}")},regexp:function(e,t){return"/"+e+"/"+t},array:function(t){return t.length==0?"[]":N(["[",x(e(t,function(e){return!A&&e[0]=="atom"&&e[1]=="undefined"?"":S(e,"seq")})),"]"])},stat:function(e){return h(e).replace(/;*\s*$/,";")},seq:function(){return x(e(c(arguments),h))},label:function(e,t){return N([L(e),":",h(t)])},"with":function(e,t){return N(["with","("+h(e)+")",h(t)])},atom:function(e){return L(e)}},P=[];return h(i)}function s(e){var t=0,n=0;return e=e.replace(/[\\\b\f\n\r\t\x22\x27]/g,function(e){switch(e){case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case'"':return++t,'"';case"'":return++n,"'"}return e}),t>n?"'"+e.replace(/\x27/g,"\\'")+"'":'"'+e.replace(/\x22/g,'\\"')+'"'}function o(e){return!e||e[0]=="block"&&(!e[1]||e[1].length==0)}function u(){function t(e,t){var n={},r;for(r in e)a(e,r)&&(n[r]=o[r],o[r]=e[r]);var i=t();for(r in n)a(n,r)&&(n[r]?o[r]=n[r]:delete o[r]);return i}function n(e){if(e==null)return null;try{u.push(e);var t=e[0],n=o[t];if(n){var r=n.apply(e,e.slice(1));if(r!=null)return r}return n=s[t],n.apply(e,e.slice(1))}finally{u.pop()}}function r(t){var r=[this[0]];return t!=null&&r.push(e(t,n)),r}function i(t){return[this[0],e(t,function(e){var t=[e[0]];return e.length>1&&(t[1]=n(e[1])),t})]}var s={string:function(e){return[this[0],e]},num:function(e){return[this[0],e]},name:function(e){return[this[0],e]},toplevel:function(t){return[this[0],e(t,n)]},block:r,splice:r,"var":i,"const":i,"try":function(t,r,i){return[this[0],e(t,n),r!=null?[r[0],e(r[1],n)]:null,i!=null?e(i,n):null]},"throw":function(e){return[this[0],n(e)]},"new":function(t,r){return[this[0],n(t),e(r,n)]},"switch":function(t,r){return[this[0],n(t),e(r,function(t){return[t[0]?n(t[0]):null,e(t[1],n)]})]},"break":function(e){return[this[0],e]},"continue":function(e){return[this[0],e]},conditional:function(e,t,r){return[this[0],n(e),n(t),n(r)]},assign:function(e,t,r){return[this[0],e,n(t),n(r)]},dot:function(e){return[this[0],n(e)].concat(c(arguments,1))},call:function(t,r){return[this[0],n(t),e(r,n)]},"function":function(t,r,i){return[this[0],t,r.slice(),e(i,n)]},defun:function(t,r,i){return[this[0],t,r.slice(),e(i,n)]},"if":function(e,t,r){return[this[0],n(e),n(t),n(r)]},"for":function(e,t,r,i){return[this[0],n(e),n(t),n(r),n(i)]},"for-in":function(e,t,r,i){return[this[0],n(e),n(t),n(r),n(i)]},"while":function(e,t){return[this[0],n(e),n(t)]},"do":function(e,t){return[this[0],n(e),n(t)]},"return":function(e){return[this[0],n(e)]},binary:function(e,t,r){return[this[0],e,n(t),n(r)]},"unary-prefix":function(e,t){return[this[0],e,n(t)]},"unary-postfix":function(e,t){return[this[0],e,n(t)]},sub:function(e,t){return[this[0],n(e),n(t)]},object:function(t){return[this[0],e(t,function(e){return e.length==2?[e[0],n(e[1])]:[e[0],n(e[1]),e[2]]})]},regexp:function(e,t){return[this[0],e,t]},array:function(t){return[this[0],e(t,n)]},stat:function(e){return[this[0],n(e)]},seq:function(){return[this[0]].concat(e(c(arguments),n))},label:function(e,t){return[this[0],e,n(t)]},"with":function(e,t){return[this[0],n(e),n(t)]},atom:function(e){return[this[0],e]}},o={},u=[];return{walk:n,with_walkers:t,parent:function(){return u[u.length-2]},stack:function(){return u}}}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function f(e,t){for(var n=t.length;--n>=0;)if(t[n]===e)return!0;return!1}function l(e){return e.split("")}function c(e,t){return Array.prototype.slice.call(e,t||0)}function h(e){var t={};for(var n=0;n<e.length;++n)t[e[n]]=!0;return t}function p(e){e instanceof Function&&(e=e());for(var t=1,n=arguments.length;--n>0;++t)arguments[t]();return e}function d(e){var t=c(arguments,1);return function(){return e.apply(this,t.concat(c(arguments)))}}function v(e,t,n){function r(e){try{return++ot.in_loop,e()}finally{--ot.in_loop}}function i(e){var t=o(e),n=ot.token.value;if(st("operator")&&a(z,n)){if(s(t))return rt(),$("assign",z[n],t,i(e));tt("Invalid assignment")}return t}function s(e){if(!t)return!0;switch(e[0]){case"dot":case"sub":case"new":case"call":return!0;case"name":return e[1]!="this"}}function o(e){var t=u(e);if(st("operator","?")){rt();var n=ct(!1);return Q(":"),$("conditional",t,n,ct(!1,e))}return t}function u(e){return l(lt(!0),0,e)}function l(e,t,n){var r=st("operator")?ot.token.value:null;r&&r=="in"&&n&&(r=null);var i=r!=null?W[r]:null;if(i!=null&&i>t){rt();var s=l(lt(!0),i,n);return l($("binary",r,e,s),t,n)}return e}function h(e,t,n){return(t=="++"||t=="--")&&!s(n)&&tt("Invalid use of "+t+" operator"),$(e,t,n)}function v(e,t){return st("punc",".")?(rt(),v($("dot",e,w()),t)):st("punc","[")?(rt(),v($("sub",e,p(ct,d(Q,"]"))),t)):t&&st("punc","(")?(rt(),v($("call",e,T(")")),!0)):t&&st("operator")&&a(U,ot.token.value)?p(d(h,"unary-postfix",ot.token.value,e),rt):e}function w(){switch(ot.token.type){case"name":case"operator":case"keyword":case"atom":return p(ot.token.value,rt);default:Z()}}function E(){switch(ot.token.type){case"num":case"string":return p(ot.token.value,rt)}return w()}function S(){var e=!0,n=[];while(!st("punc","}")){e?e=!1:Q(",");if(!t&&st("punc","}"))break;var r=ot.token.type,i=E();r!="name"||i!="get"&&i!="set"||!!st("punc",":")?(Q(":"),n.push([i,ct(!1)])):n.push([w(),at(!1),i])}return rt(),$("object",n)}function x(){return $("array",T("]",!t,!0))}function T(e,t,n){var r=!0,i=[];while(!st("punc",e)){r?r=!1:Q(",");if(t&&st("punc",e))break;st("punc",",")&&n?i.push(["atom","undefined"]):i.push(ct(!1))}return rt(),i}function N(){var e=lt(!1),t;return st("punc","(")?(rt(),t=T(")")):t=[],v($("new",e,t),!0)}function C(){return $("const",L())}function k(e){return $("var",L(e))}function L(e){var t=[];for(;;){st("name")||Z();var n=ot.token.value;rt(),st("operator","=")?(rt(),t.push([n,ct(!1,e)])):t.push([n]);if(!st("punc",","))break;rt()}return t}function A(){var e=O(),t,n;if(st("keyword","catch")){rt(),Q("("),st("name")||tt("Name expected");var r=ot.token.value;rt(),Q(")"),t=[r,O()]}return st("keyword","finally")&&(rt(),n=O()),!t&&!n&&tt("Missing catch/finally blocks"),$("try",e,t,n)}function O(){Q("{");var e=[];while(!st("punc","}"))st("eof")&&Z(),e.push(ut());return rt(),e}function M(){var e=q(),t=ut(),n;return st("keyword","else")&&(rt(),n=ut()),$("if",e,t,n)}function _(e){var t=e[0]=="var"?$("name",e[1][0]):e;rt();var n=ct();return Q(")"),$("for-in",e,t,n,r(ut))}function D(e){Q(";");var t=st("punc",";")?null:ct();Q(";");var n=st("punc",")")?null:ct();return Q(")"),$("for",e,t,n,r(ut))}function P(){Q("(");var e=null;if(!st("punc",";")){e=st("keyword","var")?(rt(),k(!0)):ct(!0,!0);if(st("operator","in"))return _(e)}return D(e)}function H(e){var t;return K()||(t=st("name")?ot.token.value:null),t!=null?(rt(),f(t,ot.labels)||tt("Label "+t+" without matching loop or statement")):ot.in_loop==0&&tt(e+" not inside a loop or switch"),J(),$(e,t)}function B(){return $("stat",p(ct,J))}function j(e){ot.labels.push(e);var n=ot.token,r=ut();return t&&!a(X,r[0])&&Z(n),ot.labels.pop(),$("label",e,r)}function F(e){return n?function(){var t=ot.token,n=e.apply(this,arguments);return n[0]=I(n[0],t,nt()),n}:e}function I(e,t,n){return e instanceof m?e:new m(e,t,n)}function q(){Q("(");var e=ct();return Q(")"),e}function $(){return c(arguments)}function J(){st("punc",";")?rt():K()||Z()}function K(){return!t&&(ot.token.nlb||st("eof")||st("punc","}"))}function Q(e){return Y("punc",e)}function Y(e,t){if(st(e,t))return rt();et(ot.token,"Unexpected token "+ot.token.type+", expected "+e)}function Z(e){e==null&&(e=ot.token),et(e,"Unexpected token: "+e.type+" ("+e.value+")")}function et(e,t){tt(t,e.line,e.col)}function tt(e,t,n,r){var i=ot.input.context();b(e,t!=null?t:i.tokline,n!=null?n:i.tokcol,r!=null?r:i.tokpos)}function nt(){return ot.prev}function rt(){return ot.prev=ot.token,ot.peeked?(ot.token=ot.peeked,ot.peeked=null):ot.token=ot.input(),ot.token}function it(){return ot.peeked||(ot.peeked=ot.input())}function st(e,t){return y(ot.token,e,t)}var ot={input:typeof e=="string"?g(e,!0):e,token:null,prev:null,peeked:null,in_function:0,in_loop:0,labels:[]};ot.token=rt();var ut=F(function(){st("operator","/")&&(ot.peeked=null,ot.token=ot.input(!0));switch(ot.token.type){case"num":case"string":case"regexp":case"operator":case"atom":return B();case"name":return y(it(),"punc",":")?j(p(ot.token.value,rt,rt)):B();case"punc":switch(ot.token.value){case"{":return $("block",O());case"[":case"(":return B();case";":return rt(),$("block");default:Z()};case"keyword":switch(p(ot.token.value,rt)){case"break":return H("break");case"continue":return H("continue");case"debugger":return J(),$("debugger");case"do":return function(e){return Y("keyword","while"),$("do",p(q,J),e)}(r(ut));case"for":return P();case"function":return at(!0);case"if":return M();case"return":return ot.in_function==0&&tt("'return' outside of function"),$("return",st("punc",";")?(rt(),null):K()?null:p(ct,J));case"switch":return $("switch",q(),ft());case"throw":return $("throw",p(ct,J));case"try":return A();case"var":return p(k,J);case"const":return p(C,J);case"while":return $("while",q(),r(ut));case"with":return $("with",q(),ut());default:Z()}}}),at=F(function(e){var t=st("name")?p(ot.token.value,rt):null;return e&&!t&&Z(),Q("("),$(e?"defun":"function",t,function(e,t){while(!st("punc",")"))e?e=!1:Q(","),st("name")||Z(),t.push(ot.token.value),rt();return rt(),t}(!0,[]),function(){++ot.in_function;var e=ot.in_loop;ot.in_loop=0;var t=O();return--ot.in_function,ot.in_loop=e,t}())}),ft=d(r,function(){Q("{");var e=[],t=null;while(!st("punc","}"))st("eof")&&Z(),st("keyword","case")?(rt(),t=[],e.push([ct(),t]),Q(":")):st("keyword","default")?(rt(),Q(":"),t=[],e.push([null,t])):(t||Z(),t.push(ut()));return rt(),e}),lt=F(function(e){if(st("operator","new"))return rt(),N();if(st("operator")&&a(R,ot.token.value))return h("unary-prefix",p(ot.token.value,rt),lt(e));if(st("punc")){switch(ot.token.value){case"(":return rt(),v(p(ct,d(Q,")")),e);case"[":return rt(),v(x(),e);case"{":return rt(),v(S(),e)}Z()}if(st("keyword","function"))return rt(),v(at(!1),e);if(a(V,ot.token.type)){var t=ot.token.type=="regexp"?$("regexp",ot.token.value[0],ot.token.value[1]):$(ot.token.type,ot.token.value);return v(p(t,rt),e)}Z()}),ct=F(function(e,t){arguments.length==0&&(e=!0);var n=i(t);return e&&st("punc",",")?(rt(),$("seq",n,ct(!0,t))):n});return $("toplevel",function(e){while(!st("eof"))e.push(ut());return e}([]))}function m(e,t,n){this.name=e,this.start=t,this.end=n}function g(e){function t(e){if(e)return u();g(),w();var t=D();if(!t)return y("eof");if(N(t))return d();if(t=='"'||t=="'")return c();if(a(F,t))return y("punc",_());if(t==".")return i();if(t=="/")return s();if(a(M,t))return o();if(t=="\\"||x(t))return r();v("Unexpected character '"+t+"'")}function n(e,t){try{return t()}catch(n){if(n!==q)throw n;v(e)}}function r(){var e=m(S);return a(k,e)?a(H,e)?y("operator",e):a(O,e)?y("atom",e):y("keyword",e):y("name",e)}function i(){return _(),N(D())?d("."):y("punc",".")}function s(){_();var e=P.regex_allowed;switch(D()){case"/":return P.comments_before.push(l()),P.regex_allowed=e,t();case"*":return P.comments_before.push(f()),P.regex_allowed=e,t()}return P.regex_allowed?u():o("/")}function o(e){function t(e){if(!D())return e;var n=e+D();return a(H,n)?(_(),t(n)):e}return y("operator",t(e||_()))}function u(){return n("Unterminated regular expression",function(){var e=!1,t="",n,r=!1;while(n=_(!0))if(e)t+="\\"+n,e=!1;else if(n=="[")r=!0,t+=n;else if(n=="]"&&r)r=!1,t+=n;else{if(n=="/"&&!r)break;n=="\\"?e=!0:t+=n}var i=m(function(e){return a(I,e)});return y("regexp",[t,i])})}function f(){return _(),n("Unterminated multiline comment",function(){var e=C("*/",!0),t=P.text.substring(P.pos,e),n=y("comment2",t,!0);return P.pos=e+2,P.line+=t.split("\n").length-1,P.newline_before=t.indexOf("\n")>=0,n})}function l(){_();var e=C("\n"),t;return e==-1?(t=P.text.substr(P.pos),P.pos=P.text.length):(t=P.text.substring(P.pos,e),P.pos=e),y("comment1",t,!0)}function c(){return n("Unterminated string constant",function(){var e=_(),t="";for(;;){var n=_(!0);if(n=="\\")n=p();else if(n==e)break;t+=n}return y("string",t)})}function h(e){var t=0;for(;e>0;--e){var n=parseInt(_(!0),16);isNaN(n)&&v("Invalid hex-character pattern in string"),t=t<<4|n}return t}function p(){var e=_(!0);switch(e){case"n":return"\n";case"r":return"\r";case"t":return"	";case"b":return"\b";case"v":return"";case"f":return"\f";case"0":return"\0";case"x":return String.fromCharCode(h(2));case"u":return String.fromCharCode(h(4));case"\n":return"";default:return e}}function d(e){var t=!1,n=!1,r=!1,i=e==".",s=m(function(s,o){return s=="x"||s=="X"?r?!1:r=!0:!!r||s!="E"&&s!="e"?s=="-"?n||o==0&&!e?!0:!1:s=="+"?n:(n=!1,s=="."?!i&&!r?i=!0:!1:T(s)):t?!1:t=n=!0});e&&(s=e+s);var o=E(s);if(!isNaN(o))return y("num",o);v("Invalid syntax: "+s)}function v(e){b(e,P.tokline,P.tokcol,P.tokpos)}function m(e){var t="",n=D(),r=0;while(n&&e(n,r++))t+=_(),n=D();return t}function g(){while(a(B,D()))_()}function y(e,t,n){P.regex_allowed=e=="operator"&&!a(U,t)||e=="keyword"&&a(A,t)||e=="punc"&&a(j,t);var r={type:e,value:t,line:P.tokline,col:P.tokcol,pos:P.tokpos,nlb:P.newline_before};return n||(r.comments_before=P.comments_before,P.comments_before=[]),P.newline_before=!1,r}function w(){P.tokline=P.line,P.tokcol=P.col,P.tokpos=P.pos}function C(e,t){var n=P.text.indexOf(e,P.pos);if(t&&n==-1)throw q;return n}function L(){return!P.peek()}function _(e){var t=P.text.charAt(P.pos++);if(e&&!t)throw q;return t=="\n"?(P.newline_before=!0,++P.line,P.col=0):++P.col,t}function D(){return P.text.charAt(P.pos)}var P={text:e.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,""),pos:0,tokpos:0,line:0,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[]};return t.context=function(e){return e&&(P=e),P},t}function y(e,t,n){return e.type==t&&(n==null||e.value==n)}function b(e,t,n,r){throw new w(e,t,n,r)}function w(e,t,n,r){this.message=e,this.line=t,this.col=n,this.pos=r}function E(e){if(_.test(e))return parseInt(e.substr(2),16);if(D.test(e))return parseInt(e.substr(1),8);if(P.test(e))return parseFloat(e)}function S(e){return x(e)||N(e)}function x(e){return e=="$"||e=="_"||C(e)}function T(e){return N(e)||C(e)}function N(e){return e=e.charCodeAt(0),e>=48&&e<=57}function C(e){return e=e.charCodeAt(0),e>=65&&e<=90||e>=97&&e<=122}var k=h(["break","case","catch","const","continue","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","throw","try","typeof","var","void","while","with"]),L=h(["abstract","boolean","byte","char","class","debugger","double","enum","export","extends","final","float","goto","implements","import","int","interface","long","native","package","private","protected","public","short","static","super","synchronized","throws","transient","volatile"]),A=h(["return","new","delete","throw","else","case"]),O=h(["false","null","true","undefined"]),M=h(l("+-*&%=<>!?|~^")),_=/^0x[0-9a-f]+$/i,D=/^0[0-7]+$/,P=/^\d*\.?\d*(?:e[+-]?\d*(?:\d\.?|\.?\d)\d*)?$/i,H=h(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&=","&&","||"]),B=h(l(" \n\r	")),j=h(l("[{}(,.;:")),F=h(l("[]{}(),;:")),I=h(l("gmsiy"));w.prototype.toString=function(){return this.message+" (line: "+this.line+", col: "+this.col+", pos: "+this.pos+")"};var q={},R=h(["typeof","void","delete","--","++","!","~","-","+"]),U=h(["--","++"]),z=function(e,t,n){while(n<e.length)t[e[n]]=e[n].substr(0,e[n].length-1),n++;return t}(["+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&="],{"=":!0},0),W=function(e,t){for(var n=0,r=1;n<e.length;++n,++r){var i=e[n];for(var s=0;s<i.length;++s)t[i[s]]=r}return t}([["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]],{}),X=h(["for","do","while","switch"]),V=h(["atom","num","string","regexp","name"]);m.prototype.toString=function(){return this.name};var $=h(["name","array","object","string","dot","sub","call","regexp"]),J=h(["if","while","do","for","for-in","with"]);return{parse:v,gen_code:i,tokenizer:g,ast_walker:u}},operators={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"modulo","==":"equals","!=":"equals"},signOperators={"-":"negate"};return DomEvent.add(window,{load:load}),{compile:compile,evaluate:evaluate,load:load,getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}};return this.load=PaperScript.load,Base.each(this,function(e,t){e&&e.prototype instanceof Base&&(e._name=t)}),this.enumerable=!0,new(PaperScope.inject(this))}